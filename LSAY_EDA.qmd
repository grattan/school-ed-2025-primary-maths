---
title: "LSAY_EDA"
format: 
  html: 
    toc: true
    toc_float: true
    toc_depth: 3
editor: visual
---

```{r}
library(haven)
library(tidyverse)
library(dplyr)
library(survey)
library(intsvy)
library(kableExtra)

LSAY2003 <- read_dta("data/lsay_data/au.edu.anu.ada.ddi.01111_v7.1_unrestricted.dta")


```

## Y03

How many primary school teachers are in the data set?

ASCED code looking for 070103 (Teacher Education: Primary) Looking at field of study: Main area of study/training in this course.

There were **29** people studying primary school teaching at some point in the Y03 data.

```{r}
#0 and 1 if 70103
#sum rows function
#filter if it is greater than or equal to 1

UNIQUE_STUDYING_TEACHERS <- LSAY2003 %>%
  # selecting variables for current area of study
  select(STIDSTD, LBCZ087, LCCZ087, LDCZ087, LEC087, LFC087, LGC087, LHC087, LIC087, LJC088, LKC088) %>%
  # Mutate across the observation to replace 0 = not '70103', 1 = is '70103'
  mutate(across(c(LBCZ087, LCCZ087, LDCZ087, LEC087, LFC087, LGC087, LHC087, LIC087, LJC088, LKC088),
                ~ case_when(
                   as.character(.) == '70103' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_, # Retain NA
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # Create new column where any 1 in the row = TRUE, no 1 = FALSE
  mutate(TEACHERS = if_any(c(LBCZ087, LCCZ087, LDCZ087, LEC087, LFC087, LGC087, LHC087, LIC087, LJC088, LKC088), ~ . == 1)) %>%
  # Keep TRUE values
  filter(TEACHERS)

UNIQUE_STUDYING_TEACHERS


 UNIQUE_STUDYING_TEACHERS_Y03 <- kbl(UNIQUE_STUDYING_TEACHERS, caption = "Count of Primary School Education Students in Y03 Data.") %>%
  kable_paper() %>%
  row_spec(0, background = "orange", bold = TRUE) %>%
  scroll_box(width = "1200px", height = "400px")

UNIQUE_STUDYING_TEACHERS_Y03

```

```{r}
# taking a deeper look at  student id 2659 and 9362
# looking at variable LHC087 as that's where both observations returned 0.
closer_look <- LSAY2003 %>% 
  filter(STIDSTD %in% c(2659, 10049)) %>% 
  select(STIDSTD, LDCZ087, LHC087) %>%
  mutate(NEW_COURSE = c("Business Management", "Human Movement"))

kbl(closer_look, caption = "Closer look at students who left teaching.") %>%
  kable_paper() %>%
  row_spec(0, background = "orange", bold = TRUE) %>%
  scroll_box(width = "945px", height = "200px")
closer_look
```

Student 2659 went into another field of study four years after: Business management (80301) Student 10049 went into another field of study four years after: Human Movement (69903)

## How many people were working as a primary school teacher at any point of responding to the questions?

"What kind of work do you do?" (LDD025, LED025, LFD025, LGD025, LHD029, LID029, LJD029, LKD029). \* ANSZCO code = 2412 for primary school teachers.

```{r}
# SEEING THE AMOUNT PEOPLE WHO WERE PRIMARY SCHOOL TEACHERS AT ANY POINT

UNIQUE_TEACHERS_Y03 <- LSAY2003 %>%
  # SELECTING VARIABLES FOR WHAT TYPE OF WORK DO YOU DO
  select(STIDSTD, LDD025, LED025, LFD025, LGD025, LHD029, LID029, LJD029, LKD029) %>%
  # CHARACTER TYPE ACROSS
  mutate(across(c(LDD025, LED025, LFD025, LGD025, LHD029, LID029, LJD029, LKD029), as.character)) %>%
  # MUTATE ACROSS THE OBSERVATION 0 = NOT TEACHER, 1 = TEACHER, NA = NA. 
  mutate(across(c(LDD025, LED025, LFD025, LGD025, LHD029, LID029, LJD029, LKD029), ~ case_when(
    . == '2412' ~ 1, #TEACHER AS 1
    is.na(.) ~ NA_integer_, # RETAIN NA
    TRUE ~ 0 # NON-TEACHER AS 0
  ))) %>%
  # CREATE NEW COLUMN WHERE ANY 1 IN THE ROW = TRUE (TEACHER), NO 1 = FALSE
  mutate(legit_teachers = if_any(c(LDD025, LED025, LFD025, LGD025, LHD029, LID029, LJD029, LKD029), ~ . == 1)) %>%
  filter(legit_teachers) #FILTER FOR TRUE CONDITION

UNIQUE_TEACHERS_Y03

 UNIQUE_TEACHERS_Y03_table <- kbl(UNIQUE_TEACHERS_Y03, caption = "Number of Teachers in the Y03 Data.") %>%
  kable_paper() %>%
  row_spec(0, background = "orange", bold = TRUE) %>%
  scroll_box(width = "1200px", height = "400px")

```

What did these people study?

```{r}
# Selecting IDs which correlate to teachers 
teacher_jobs <- LSAY2003[LSAY2003$STIDSTD %in% UNIQUE_TEACHERS_Y03$STIDSTD, ]

# Using those IDs and selecting area of study to see their area of study
selected_columns <- c('STIDSTD', 'LBCZ087', 'LCCZ087', 'LDCZ087', 'LEC087', 'LFC087', 'LGC087', 'LHC087', 'LIC087', 'LJC088', 'LKC088')
teacher_jobs <- teacher_jobs[, selected_columns]

```

+------------+------------------------------------------------------+
| Codes      | Field of Education                                   |
+============+======================================================+
| 70101      | Teacher Education: Early Childhood                   |
+------------+------------------------------------------------------+
| 70103      | Teacher Education: Primary                           |
+------------+------------------------------------------------------+
| 70109      | Teacher Education: Vocational Education and Training |
+------------+------------------------------------------------------+
| 70199      | Teacher Education, n.e.c.                            |
|            |                                                      |
|            | -   special needs                                    |
+------------+------------------------------------------------------+
| 70115      | English as a Second Language Teaching                |
+------------+------------------------------------------------------+
| 90503      | Children's Services                                  |
|            |                                                      |
|            | (Human Welfare Studies and Services)                 |
+------------+------------------------------------------------------+
| 91703      | Religious Studies                                    |
|            |                                                      |
|            | (Philosophy and Religious Studies)                   |
+------------+------------------------------------------------------+
| 92101      | Sport and Recreation Activities                      |
|            |                                                      |
|            | (Sport and Recreation)                               |
+------------+------------------------------------------------------+
| 100101     | Music                                                |
|            |                                                      |
|            | (Performing Arts)                                    |
+------------+------------------------------------------------------+
| 80101      | Accounting                                           |
+------------+------------------------------------------------------+

```{r}
fields <- data.frame(
  Codes = c(70101, 70103, 70109, 70199, 70115, 90503, 91703, 92101, 100101, 80101),
  `Field_of_Education` = c(
    "Teacher Education: Early Childhood",
    "Teacher Education: Primary",
    "Teacher Education: Vocational Education and Training",
    "Teacher Education, n.e.c.",
    "English as a Second Language Teaching",
    "Children's Services", 
    "Religious Studies", 
    "Sport and Recreation Activities",
    "Music", "Accounting"
  )
)

 fields <- kbl(fields, caption = "Area of Study for Teachers in Y03.") %>%
  kable_paper() %>%
  row_spec(0, background = "orange", bold = TRUE) %>%
  scroll_box(width = "1000px", height = "300px")
fields

```

# Understanding how many school leavers enrol in primary school teaching courses

```{r}
#taking the IDs of individuals who had enrolled in primary school teaching at some point
studying_teachers <- unique(UNIQUE_STUDYING_TEACHERS$STIDSTD)
# filter the LSAY2003 data for those IDs and high school leaving variables.
studying_teachers_y12 <- LSAY2003 %>% 
  filter(STIDSTD %in% studying_teachers) %>% 
  select(STIDSTD, LBWDV01, LCWDV01, LEWDV01, LIWDV01) %>%
   mutate(Studying_Teacher = rowSums(select(., LBWDV01, LCWDV01, LEWDV01, LIWDV01) == 1, na.rm = TRUE) > 0)

```

Only two of those studying primary school teaching in 2003 LSAY were school leavers. However both seemed to have return back to school to complete.

2999 & 10049 (leavers)

```{r}
# closer look at the school leavers (year and level)
school_leavers_year_level <- LSAY2003 %>% 
  filter(STIDSTD %in% c(2999, 10049)) %>% 
  select(STIDSTD, LBB001, LCB001, LDB001, LEB001, LEA005, LFB001, LFA006)
school_leavers_year_level
```

Both left in year 11.

```{r}
school_leavers_year <- LSAY2003 %>% 
  filter(STIDSTD %in% c(2999, 10049)) %>% 
  select(STIDSTD, LBA002B, LCA002B, LDA002B, LEA002B, LFA002Y)
school_leavers_year
```

**2999 LEFT IN 2003, 10049 LEFT IN 2004.**

-   2999 left in 2003 then went back to complete year 12 in 2005

-   10049 left in 2004 and then went back to complete year 12 in 2005.

# PISA PVs

-   Determine the percentage of primary teachers in the sample below the National proficient standard

-   Determine the average achievement of primary teachers in the sample (in PISA points)

```{r}
# understanding PVs (exploratory understanding)
# using intsvy package to calculate average scores for each state
library(intsvy)
pisa_state <- pisa.mean.pv(pvlabel = paste0("PV", 1:5, "MATH"), by = "STATEID", data = LSAY2003) %>%
  mutate(STATE = c("ACT", "NSW", "VIC", "QLD", "SA", "WA", "TAS", "NT"))

 pisa_state <- kbl(pisa_state, caption = "Average Math Performance Across States") %>%
  kable_paper() %>%
  row_spec(0, background = "orange", bold = TRUE) %>%
  scroll_box(width = "1000px", height = "300px")
pisa_state
```

"In mathematical literacy, the average performance of students in the Australian Capital Territory was significantly higher than the average achieved by students in New South Wales, Queensland, Victoria, Tasmania and the Northern Territory, and students from the Australian Capital Territory, Western Australia, South Australia, New South Wales and Queensland attained a higher average score than students in the Northern Territory. However, the performance of students in Victoria and Tasmania was not significantly different from the performance of students in the Northern Territory. These differences are more pronounced than those in maths in PISA 2000, perhaps because this measure of mathematical literacy is better defined, being the focus of [PISA 2003."](https://www.acer.org/files/PISA_screen.pdf)

```{r}
# Using Survey Package to calculate the average math scores for teachers

# include only PS teachers
teacher_ids <- UNIQUE_TEACHERS_Y03$STIDSTD
teacher_data <- LSAY2003[LSAY2003$STIDSTD %in% teacher_ids, ]

options(survey.lonely.psu = "adjust")

# school-level stratification and student-level sampling
teacher_design_03 <- svydesign(
  ids = ~SCHOOLID + STIDSTD,  # two-stage sampling: schools then students
  strata = ~STATEID + SECTOR,  # stratification variables as per tech report
  weights = ~W_FSTUWT,  # weights column in the data frame
  data = teacher_data, # teacher data frame
  nest = TRUE  
)

# mean math scores for each plausible value
mean_pv1 <- svymean(~PV1MATH, teacher_design_03)
mean_pv2 <- svymean(~PV2MATH, teacher_design_03)
mean_pv3 <- svymean(~PV3MATH, teacher_design_03)
mean_pv4 <- svymean(~PV4MATH, teacher_design_03)
mean_pv5 <- svymean(~PV5MATH, teacher_design_03)

# taking only the means
mean_pv1_val <- coef(mean_pv1)
mean_pv2_val <- coef(mean_pv2)
mean_pv3_val <- coef(mean_pv3)
mean_pv4_val <- coef(mean_pv4)
mean_pv5_val <- coef(mean_pv5)

# finding the overall mean score by averaging all the means of PVs
overall_mean_math_pv <- mean(c(mean_pv1_val, mean_pv2_val, mean_pv3_val, mean_pv4_val, mean_pv5_val))

# average math score for teachers
overall_mean_math_pv

#histograms
#hist(teacher_data$PV1MATH, main = "Histogram of PV1MATH", xlab = "PV1MATH") 
 # abline(v = mean(teacher_data$PV1MATH), col = "red")
  
#hist(teacher_data$W_FSTUWT, main = "Histogram of PV1MATH", xlab = "PV1MATH") 
  #abline(v = mean(teacher_data$PV1MATH), col = "red")

```

```{r eval=FALSE, echo=FALSE}
# this chunk is just checking to see if survey package gives similar results to intsvy package

# survey options to handle strata with only one PSU
options(survey.lonely.psu = "adjust")

# create survey design object: stratification by schoolid? each obs independent
teacher_design <- svydesign(ids = ~1, strata = ~SCHOOLID, weights = ~W_FSTUWT, data = LSAY2003)

# calc mean math scores for each PV
mean_pv1 <- svymean(~PV1MATH, teacher_design)
mean_pv2 <- svymean(~PV2MATH, teacher_design)
mean_pv3 <- svymean(~PV3MATH, teacher_design)
mean_pv4 <- svymean(~PV4MATH, teacher_design)
mean_pv5 <- svymean(~PV5MATH, teacher_design)

# extracting means
mean_pv1_val <- coef(mean_pv1)
mean_pv2_val <- coef(mean_pv2)
mean_pv3_val <- coef(mean_pv3)
mean_pv4_val <- coef(mean_pv4)
mean_pv5_val <- coef(mean_pv5)

# overall mean score
overall_mean_math_pv <- mean(c(mean_pv1_val, mean_pv2_val, mean_pv3_val, mean_pv4_val, mean_pv5_val))


overall_mean_math_pv

# Using intsvy to get mean for school

pisa_means_intsvy <- pisa.mean.pv(pvlabel = paste0("PV", 1:5, "MATH"), by = "SCHOOLID", data = LSAY2003)
overall_school_mean <- mean(pisa_means_intsvy$Mean)


overall_mean_math_pv #using survey package method
overall_school_mean #using intsvy package method


```

There is a discrepancy between the two different methods.

Seems as though the level 3 proficiency levels for mathematics literacy is 482 in later years as well. \* [2018](https://nces.ed.gov/surveys/pisa/pisa2018/pdf/MathProfLevelDescriptionV2.pdf) \* [2022](https://nces.ed.gov/surveys/pisa/pisa2022/docs/DescriptionsOf2022ProficiencyLevels-TableI31.pdf)

```{r}
library(survey)

# mean math scores for each teacher across each pv first
mean_pv1_by_teacher <- svyby(~PV1MATH, ~STIDSTD, teacher_design_03, svymean)
mean_pv2_by_teacher <- svyby(~PV2MATH, ~STIDSTD, teacher_design_03, svymean)
mean_pv3_by_teacher <- svyby(~PV3MATH, ~STIDSTD, teacher_design_03, svymean)
mean_pv4_by_teacher <- svyby(~PV4MATH, ~STIDSTD, teacher_design_03, svymean)
mean_pv5_by_teacher <- svyby(~PV5MATH, ~STIDSTD, teacher_design_03, svymean)

# creating a data frame with ID and mean for each PV for each ID
teacher_means_03 <- data.frame(
  STIDSTD = mean_pv1_by_teacher$STIDSTD,
  mean_pv1 = mean_pv1_by_teacher$PV1MATH,
  mean_pv2 = mean_pv2_by_teacher$PV2MATH,
  mean_pv3 = mean_pv3_by_teacher$PV3MATH,
  mean_pv4 = mean_pv4_by_teacher$PV4MATH,
  mean_pv5 = mean_pv5_by_teacher$PV5MATH
)

# second average across the row for each teacher
teacher_means_03$mean_score = rowMeans(teacher_means_03[, -1])

threshold <- 549.5463 # average for teacher performance
proficient_standard <- 482 # level 3 proficient standard

# how many teachers are below teacher avg
teacher_means_03$below_avg_teacher = teacher_means_03$mean_score < threshold 

# how many teachers are below proficient standard (482)
teacher_means_03$below_prof_avg = teacher_means_03$mean_score < proficient_standard


```

```{r}
# seeing how many are below average -- true = below average (549.5463)
teachers_below_avg <- table(teacher_means_03$below_prof_avg)
teachers_below_avg
```

```{r}
# seeing how many are below proficient standard -- true = below proficient standard (482)
teachers_below_profstand <- table(teacher_means_03$below_prof_avg)
teachers_below_profstand
```

```{r}
# look at teacher_means and create possible row at the bottom w/ percentage above/below average

```

## Y06 LSAY

```{r}
LSAY2006 <- read_dta("data/lsay_data/au.edu.anu.ada.ddi.01137_v10.1_unrestricted.dta")
```

```{r}
# 2006 COHORT - exploring those who studied primary school teaching
STUDYING_TEACHERS_2006 <- LSAY2006 %>%
  # selecting variables for current area of study
  select(STIDSTD, LBC087, LCC087, LDC087, LEC087, LFC087, LGC088, LHC088, LIC088, LJC088, LKC088) %>%
  # Mutate across the observation to replace 0 = not '70103', 1 = is '70103'
  mutate(across(c(LBC087, LCC087, LDC087, LEC087, LFC087, LGC088, LHC088, LIC088, LJC088, LKC088),
                ~ case_when(
                   as.character(.) == '70103' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_, # Retain NA
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # Create new column where any 1 in the row = TRUE, no 1 = FALSE
  mutate(unique_teachers = if_any(c(LBC087, LCC087, LDC087, LEC087, LFC087, LGC088, LHC088, LIC088, LJC088, LKC088), ~ . == 1)) %>%
  # Keep TRUE values
  filter(unique_teachers)

STUDYING_TEACHERS_2006
```

```{r}
# Looking at people who were at the time working as PS Teachers

LEGIT_TEACHERS_2006 <- LSAY2006 %>%
  # Selecting variables for kind of work
  select(STIDSTD, LBD011, LCD024, LDD024, LED029, LFD029, LGD029, LHD029, LID029, LJD029, LKD029) %>%
  # Mutate across the observation 
  mutate(across(c(LBD011, LCD024, LDD024, LED029, LFD029, LGD029, LHD029, LID029, LJD029, LKD029),
                ~ case_when(
                   as.character(.) == '2412' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_,
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # column for TRUE = legit teachers, FALSE = not teachers
  mutate(legit_teachers = if_any(c(LBD011, LCD024, LDD024, LED029, LFD029, LGD029, LHD029, LID029, LJD029, LKD029), ~ . == 1)) %>%
  # Filter for TRUE condition
  filter(legit_teachers)

LEGIT_TEACHERS_2006
```

```{r}
# Taking a look at what the legit teachers studied
teacher_jobs <- LSAY2006[LSAY2006$STIDSTD %in% LEGIT_TEACHERS_2006$STIDSTD, ]

# selecting student ID and area of study across the years
selected_columns <- c('STIDSTD', 'LBC087', 'LCC087', 'LDC087', 'LEC087', 'LFC087', 'LGC088', 'LHC088', 'LIC088', 'LJC088', 'LKC088')
teacher_jobs <- teacher_jobs[, selected_columns]
```

| Code   | Field                              |
|--------|------------------------------------|
| 100705 | Written Communication              |
| 100103 | Drama and Theatre Studies          |
| 100101 | Music                              |
| 80399  | Business and Management, n.e.c.    |
| 70103  | Teacher Education: Primary         |
| 70101  | Teacher Education: Early Childhood |
| 70105  | Teacher Education: Secondary       |
| 70199  | Teacher Education, n.e.c.          |
| 91701  | Philosophy                         |
| 60901  | Optometry                          |
| 61399  | Public Health, n.e.c.              |
| 60101  | General Medicine                   |
| 91703  | Religious Studies                  |
| 80101  | Accounting                         |
| 81101  | Banking and Finance                |
| 91523  | Literature                         |
| 90513  | Counselling                        |

```{r}
aos_2006 <- data.frame(
  Code = c(100705, 100103, 100101, 80399, 70103, 70101, 70105, 70199, 91701, 60901, 61399, 60101, 91703, 80101, 81101, 91523, 90513),
  Field = c(
    "Written Communication",
    "Drama and Theatre Studies",
    "Music",
    "Business and Management, n.e.c.",
    "Teacher Education: Primary",
    "Teacher Education: Early Childhood",
    "Teacher Education: Secondary",
    "Teacher Education, n.e.c.",
    "Philosophy",
    "Optometry",
    "Public Health, n.e.c.",
    "General Medicine",
    "Religious Studies",
    "Accounting",
    "Banking and Finance",
    "Literature",
    "Counselling"
  )
)
aos_2006 <- kable(aos_2006, caption = "Field of Education Codes 2006", align = "c", booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  row_spec(0, background = "orange", bold = TRUE, color = "white") %>%
  column_spec(1, bold = TRUE)

aos_2006


```

```{r}
studying_teachers <- unique(STUDYING_TEACHERS_2006$STIDSTD)
# filter the LSAY2003 data for those IDs and high school leaving variables.
studying_teachers_y12 <- LSAY2006 %>% 
  filter(STIDSTD %in% studying_teachers) %>% 
  select(STIDSTD, LBWDV01, LCWDV01, LDWDV01, LEWDV01, LFWDV01) %>%
   mutate(Studying_Teacher = rowSums(select(., LBWDV01, LCWDV01, LDWDV01, LEWDV01, LFWDV01) == 1, na.rm = TRUE) > 0)
```

# PISA PVs

-   Determine the percentage of primary teachers in the sample below the National proficient standard

-   Determine the average achievement of primary teachers in the sample (in PISA points)

```{r}

teacher_ids <- LEGIT_TEACHERS_2006$STIDSTD
teacher_data_2006 <- LSAY2006[LSAY2006$STIDSTD %in% teacher_ids, ]


options(survey.lonely.psu = "adjust")

# school-level stratification and student-level sampling
teacher_design_y06 <- svydesign(
  ids = ~SCHOOLID + STIDSTD,  # two-stage sampling: schools then students
  strata = ~STATE + SECTOR,  # stratification variables as per tech report
  weights = ~W_FSTUWT,  # weights column in the data frame
  data = teacher_data_2006, # teacher data frame
  nest = TRUE  
)
```

```{r}
library(survey)

# mean math scores for each teacher across each pv first
mean_pv1_by_teacher <- svyby(~PV1MATH, ~STIDSTD, teacher_design_y06, svymean)
mean_pv2_by_teacher <- svyby(~PV2MATH, ~STIDSTD, teacher_design_y06, svymean)
mean_pv3_by_teacher <- svyby(~PV3MATH, ~STIDSTD, teacher_design_y06, svymean)
mean_pv4_by_teacher <- svyby(~PV4MATH, ~STIDSTD, teacher_design_y06, svymean)
mean_pv5_by_teacher <- svyby(~PV5MATH, ~STIDSTD, teacher_design_y06, svymean)

# creating a data frame with ID and mean for each PV for each ID
teacher_means_y06 <- data.frame(
  STIDSTD = mean_pv1_by_teacher$STIDSTD,
  mean_pv1 = mean_pv1_by_teacher$PV1MATH,
  mean_pv2 = mean_pv2_by_teacher$PV2MATH,
  mean_pv3 = mean_pv3_by_teacher$PV3MATH,
  mean_pv4 = mean_pv4_by_teacher$PV4MATH,
  mean_pv5 = mean_pv5_by_teacher$PV5MATH
)

# second average across the row for each teacher
teacher_means_y06$mean_score = rowMeans(teacher_means_y06[, -1])

proficient_standard <- 482 # level 3 proficient standard - **double check if this has changed**

# how many teachers are below proficient standard (482)
teacher_means_y06$below_prof_avg = teacher_means_y06$mean_score < proficient_standard

teacher_means_y06_table <- kable(teacher_means_y06, caption = "Proficiency Status of Teachers in 2006", align = "c", booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  row_spec(0, background = "orange", color = "black") %>%
  scroll_box(width = "1000px", height = "300px")

teacher_means_y06_table

```

```{r}
# TRUE being below the 482 proficient standard (level 3)

teachers_below_profstand_y06 <- table(teacher_means_y06$below_prof_avg)
names(teachers_below_profstand_y06) <- c("Above Proficiency", "Below Proficiency")
teachers_below_profstand_y06

# formatting
teachers_below_profstand_y06_df <- as.data.frame(teachers_below_profstand_y06)

proficiency_y06_table <- kable(teachers_below_profstand_y06_df, caption = "Proficiency Status of Teachers in 2006", col.names = c("Proficiency Status", "Count"), align = "c", booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  row_spec(0, background = "orange", color = "black") %>%
  column_spec(column = c(1,2), color = "black")

proficiency_y06_table
```

# LSAY 2009

```{r}
# reading in 2009 data
LSAY2009 <- read_dta("data/lsay_data/au.edu.anu.ada.ddi.30023v9_unrestricted.dta")

```

```{r}
# 2009 COHORT - exploring those who studied primary school teaching
STUDYING_TEACHERS_2009 <- LSAY2009 %>%
  # selecting variables for current area of study
  select(STIDSTD, LBC089, LCC088, LDC088, LEC088, LFC088, LGC088, LHC088, LIC088, LJC088, LKC088) %>%
  # Mutate across the observation to replace 0 = not '70103', 1 = is '70103'
  mutate(across(c(LBC089, LCC088, LDC088, LEC088, LFC088, LGC088, LHC088, LIC088, LJC088, LKC088),
                ~ case_when(
                   as.character(.) == '70103' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_, # Retain NA
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # Create new column where any 1 in the row = TRUE, no 1 = FALSE
  mutate(unique_teachers = if_any(c(LBC089, LCC088, LDC088, LEC088, LFC088, LGC088, LHC088, LIC088, LJC088, LKC088), ~ . == 1)) %>%
  # Keep TRUE values
  filter(unique_teachers)

STUDYING_TEACHERS_2009
```

```{r}
# Looking at people who were at the time working as PS Teachers

LEGIT_TEACHERS_2009 <- LSAY2009 %>%
  # Selecting variables for kind of work
  select(STIDSTD, LBD014, LCD029, LDD029, LED029, LFD029, LGD029, LHD029, LID029, LJD029, LKD029) %>%
  # Mutate across the observation 
  mutate(across(c(LBD014, LCD029, LDD029, LED029, LFD029, LGD029, LHD029, LID029, LJD029, LKD029),
                ~ case_when(
                   as.character(.) == '2412' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_,
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # column for TRUE = legit teachers, FALSE = not teachers
  mutate(legit_teachers = if_any(c(LBD014, LCD029, LDD029, LED029, LFD029, LGD029, LHD029, LID029, LJD029, LKD029), ~ . == 1)) %>%
  # Filter for TRUE condition
  filter(legit_teachers)

LEGIT_TEACHERS_2009
```

```{r}
# Taking a look at what the legit teachers studied
teacher_jobs_2009 <- LSAY2009[LSAY2009$STIDSTD %in% LEGIT_TEACHERS_2009$STIDSTD, ]

# selecting student ID and area of study across the years
selected_columns <- c('STIDSTD', 'LBC089', 'LCC088', 'LDC088', 'LEC088', 'LFC088', 'LGC088', 'LHC088', 'LIC088', 'LJC088', 'LKC088')
teacher_jobs_2009 <- teacher_jobs_2009[, selected_columns]
```

What did they study?

| Code  | Field                            |
|-------|----------------------------------|
| 90701 | Psychology                       |
| 70199 | Teacher Education, n.e.c.        |
| 79999 | Education, n.e.c.                |
| 90503 | Children's Services              |
| 60501 | Pharmacy                         |
| 70103 | Teacher Education: Primary       |
| 70105 | Teacher Education: Secondary     |
| 61799 | Rehabilitation Therapies, n.e.c. |

\*\* revisit -- have to do proficiency standard \*\*

## Plausible values for 2009

```{r}

teacher_ids <- LEGIT_TEACHERS_2009$STIDSTD
teacher_data_2009 <- LSAY2009[LSAY2009$STIDSTD %in% teacher_ids, ]


options(survey.lonely.psu = "adjust")

# school-level stratification and student-level sampling
teacher_design_y09 <- svydesign(
  ids = ~SCHOOLID + STIDSTD,  # two-stage sampling: schools then students
  strata = ~STATE + SECTOR,  # stratification variables as per tech report
  weights = ~W_FSTUWT,  # weights column in the data frame
  data = teacher_data_2009, # teacher data frame
  nest = TRUE  
)
```

```{r}
library(survey)

# mean math scores for each teacher across each pv first
mean_pv1_by_teacher <- svyby(~PV1MATH, ~STIDSTD, teacher_design_y09, svymean)
mean_pv2_by_teacher <- svyby(~PV2MATH, ~STIDSTD, teacher_design_y09, svymean)
mean_pv3_by_teacher <- svyby(~PV3MATH, ~STIDSTD, teacher_design_y09, svymean)
mean_pv4_by_teacher <- svyby(~PV4MATH, ~STIDSTD, teacher_design_y09, svymean)
mean_pv5_by_teacher <- svyby(~PV5MATH, ~STIDSTD, teacher_design_y09, svymean)

# creating a data frame with ID and mean for each PV for each ID
teacher_means_y09 <- data.frame(
  STIDSTD = mean_pv1_by_teacher$STIDSTD,
  mean_pv1 = mean_pv1_by_teacher$PV1MATH,
  mean_pv2 = mean_pv2_by_teacher$PV2MATH,
  mean_pv3 = mean_pv3_by_teacher$PV3MATH,
  mean_pv4 = mean_pv4_by_teacher$PV4MATH,
  mean_pv5 = mean_pv5_by_teacher$PV5MATH
)

# second average across the row for each teacher
teacher_means_y09$mean_score = rowMeans(teacher_means_y09[, -1])

proficient_standard <- 482 # level 3 proficient standard - **double check if this has changed**

# how many teachers are below proficient standard (482)
teacher_means_y09$below_prof_avg = teacher_means_y09$mean_score < proficient_standard

teacher_means_y09_table <- kable(teacher_means_y09, caption = "Proficiency Status of Teachers in 2009", align = "c", booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  row_spec(0, background = "orange", color = "black") %>%
  scroll_box(width = "1000px", height = "300px")

teacher_means_y09_table

```

```{r}
# TRUE being below the 482 proficient standard (level 3)

teachers_below_profstand_y09 <- table(teacher_means_y09$below_prof_avg)
names(teachers_below_profstand_y09) <- c("Above Proficiency", "Below Proficiency")
teachers_below_profstand_y09

# formatting
teachers_below_profstand_y09_df <- as.data.frame(teachers_below_profstand_y09)

proficiency_y09 <- kable(teachers_below_profstand_y09_df, caption = "Proficiency Status of Teachers in 2009", col.names = c("Proficiency Status", "Count"), align = "c", booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  row_spec(0, background = "orange", color = "black") %>%
  column_spec(column = c(1,2), color = "black")

proficiency_y09
```

# LSAY 2015

```{r}
LSAY2015 <- read_dta("data/lsay_data/2_LSAY_Y15_2022_STATA_01392_general.dta")
```

```{r}
# 2009 COHORT - exploring those who studied primary school teaching
STUDYING_TEACHERS_2015 <- LSAY2015 %>%
  # selecting variables for current area of study
  select(LSAYID, LCC088, LDC088, LEC088, LFC088, LGC088, LHC088) %>%
  # Mutate across the observation to replace 0 = not '70103', 1 = is '70103'
  mutate(across(c(LCC088, LDC088, LEC088, LFC088, LGC088, LHC088),
                ~ case_when(
                   as.character(.) == '70103' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_, # Retain NA
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # Create new column where any 1 in the row = TRUE, no 1 = FALSE
  mutate(unique_teachers = if_any(c(LCC088, LDC088, LEC088, LFC088, LGC088, LHC088), ~ . == 1)) %>%
  # Keep TRUE values
  filter(unique_teachers)

STUDYING_TEACHERS_2015
```

```{r}
# Looking at people who were at the time working as PS Teachers

LEGIT_TEACHERS_2015 <- LSAY2015 %>%
  # Selecting variables for kind of work
  select(LSAYID, LBEM004, LCD022, LDD022, LED022, LFD025, LGD022, LHD022) %>%
  # Mutate across the observation 
  mutate(across(c(LBEM004, LCD022, LDD022, LED022, LFD025, LGD022, LHD022),
                ~ case_when(
                   as.character(.) == '2412' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_,
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # column for TRUE = legit teachers, FALSE = not teachers
  mutate(legit_teachers = if_any(c(LBEM004, LCD022, LDD022, LED022, LFD025, LGD022, LHD022), ~ . == 1)) %>%
  # Filter for TRUE condition
  filter(legit_teachers)

LEGIT_TEACHERS_2015
```

```{r}
# Taking a look at what the legit teachers studied
teacher_jobs_2015 <- LSAY2015[LSAY2015$LSAYID %in% LEGIT_TEACHERS_2015$LSAYID, ]

# selecting student ID and area of study across the years
selected_columns <- c('LSAYID', 'LCC088', 'LDC088', 'LEC088', 'LFC088', 'LGC088', 'LHC088')
teacher_jobs_2015 <- teacher_jobs_2015[, selected_columns]
```

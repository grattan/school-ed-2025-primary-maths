---
title: "LSAY_EDA"
format: html
editor: visual
---

```{r}
library(haven)
library(tidyverse)
library(dplyr)
library(survey)
library(intsvy)

LSAY2003 <- read_dta("data/lsay_data/au.edu.anu.ada.ddi.01111_v7.1_unrestricted.dta")


```

ASCED code looking for 070103 (Teacher Education: Primary) Looking at field of study: Main area of study/training in this course.

## Y03

How many primary school teachers are in the data set?

```{r}
#0 and 1 if 70103
#sum rows function
#filter if it is greater than or equal to 1

UNIQUE_STUDYING_TEACHERS <- LSAY2003 %>%
  # selecting variables for current area of study
  select(STIDSTD, LBCZ087, LCCZ087, LDCZ087, LEC087, LFC087, LGC087, LHC087, LIC087, LJC088, LKC088) %>%
  # Mutate across the observation to replace 0 = not '70103', 1 = is '70103'
  mutate(across(c(LBCZ087, LCCZ087, LDCZ087, LEC087, LFC087, LGC087, LHC087, LIC087, LJC088, LKC088),
                ~ case_when(
                   as.character(.) == '70103' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_, # Retain NA
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # Create new column where any 1 in the row = TRUE, no 1 = FALSE
  mutate(unique_teachers = if_any(c(LBCZ087, LCCZ087, LDCZ087, LEC087, LFC087, LGC087, LHC087, LIC087, LJC088, LKC088), ~ . == 1)) %>%
  # Keep TRUE values
  filter(unique_teachers)

UNIQUE_STUDYING_TEACHERS


```

```{r}
# taking a deeper look at  student id 2659 and 9362
# looking at variable LHC087
closer_look <- LSAY2003 %>% 
  filter(STIDSTD %in% c(2659, 10049)) %>% 
  select(STIDSTD, LDCZ087, LHC087)
closer_look
```

Student 2659 went into another field of study four years after: Business management Student 10049 went into another field of study four years after too??: Human Movement

-   How many are working as primary school teachers
-   Look for legit teachers

```{r}

UNIQUE_LEGIT_TEACHERS <- LSAY2003 %>%
  # Selecting variables for kind of work
  select(STIDSTD, LDD025, LED025, LFD025, LGD025, LHD029, LID029, LJD029, LKD029) %>%
  # Mutate across the observation 
  mutate(across(c(LDD025, LED025, LFD025, LGD025, LHD029, LID029, LJD029, LKD029),
                ~ case_when(
                   as.character(.) == '2412' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_,
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # column for TRUE = legit teachers, FALSE = not teachers
  mutate(legit_teachers = if_any(c(LDD025, LED025, LFD025, LGD025, LHD029, LID029, LJD029, LKD029), ~ . == 1)) %>%
  # Filter for TRUE condition
  filter(legit_teachers)

UNIQUE_LEGIT_TEACHERS

 
```

```{r}
# SEEING THE AMOUNT PEOPLE WHO WERE PRIMARY SCHOOL TEACHERS AT ANY POINT

UNIQUE_LEGIT_TEACHERS <- LSAY2003 %>%
  # SELECTING VARIABLES FOR WHAT TYPE OF WORK DO YOU DO
  select(STIDSTD, LDD025, LED025, LFD025, LGD025, LHD029, LID029, LJD029, LKD029) %>%
  # CHARACTER TYPE ACROSS
  mutate(across(c(LDD025, LED025, LFD025, LGD025, LHD029, LID029, LJD029, LKD029), as.character)) %>%
  # MUTATE ACROSS THE OBSERVATION 0 = NOT TEACHER, 1 = TEACHER, NA = NA. 
  mutate(across(c(LDD025, LED025, LFD025, LGD025, LHD029, LID029, LJD029, LKD029), ~ case_when(
    . == '2412' ~ 1, #TEACHER AS 1
    is.na(.) ~ NA_integer_,
    TRUE ~ 0 # NON-TEACHER AS 0
  ))) %>%
  # CREATE NEW COLUMN WHERE ANY 1 IN THE ROW = TRUE, NO 1 = FALSE
  mutate(legit_teachers = if_any(c(LDD025, LED025, LFD025, LGD025, LHD029, LID029, LJD029, LKD029), ~ . == 1)) %>%
  filter(legit_teachers) #FILTER FOR TRUE CONDITION

UNIQUE_LEGIT_TEACHERS

```

What did these people study?

```{r}
# Taking a look at what the legit teachers studied
teacher_jobs <- LSAY2003[LSAY2003$STIDSTD %in% UNIQUE_LEGIT_TEACHERS$STIDSTD, ]

# selecting student ID and area of study across the years
selected_columns <- c('STIDSTD', 'LBCZ087', 'LCCZ087', 'LDCZ087', 'LEC087', 'LFC087', 'LGC087', 'LHC087', 'LIC087', 'LJC088', 'LKC088')
teacher_jobs <- teacher_jobs[, selected_columns]



```

+----------------+------------------------------------------------------+
| Codes          | Field of Education                                   |
+================+======================================================+
| 70101          | Teacher Education: Early Childhood                   |
+----------------+------------------------------------------------------+
| 70103          | Teacher Education: Primary                           |
+----------------+------------------------------------------------------+
| 70109          | Teacher Education: Vocational Education and Training |
+----------------+------------------------------------------------------+
| 70199          | Teacher Education, n.e.c.                            |
|                |                                                      |
|                | -   special needs                                    |
+----------------+------------------------------------------------------+
| 70115          | English as a Second Language Teaching                |
+----------------+------------------------------------------------------+
| 90503          | Children's Services                                  |
|                |                                                      |
|                | (Human Welfare Studies and Services)                 |
+----------------+------------------------------------------------------+
| 91703          | Religious Studies                                    |
|                |                                                      |
|                | (Philosophy and Religious Studies)                   |
+----------------+------------------------------------------------------+
| 92101          | Sport and Recreation Activities                      |
|                |                                                      |
|                | (Sport and Recreation)                               |
+----------------+------------------------------------------------------+
| 100101         | Music                                                |
|                |                                                      |
|                | (Performing Arts)                                    |
+----------------+------------------------------------------------------+
| 80101          | Accounting                                           |
+----------------+------------------------------------------------------+

```{r}
# How many school leavers enrol in primary school teaching courses
#taking the IDs of individuals who had enrolled in primary school teaching at some point
studying_teachers <- unique(UNIQUE_STUDYING_TEACHERS$STIDSTD)
# filter the LSAY2003 data for those IDs and high school leaving variables.
studying_teachers_y12 <- LSAY2003 %>% 
  filter(STIDSTD %in% studying_teachers) %>% 
  select(STIDSTD, LBWDV01, LCWDV01, LEWDV01, LIWDV01) %>%
   mutate(Studying_Teacher = rowSums(select(., LBWDV01, LCWDV01, LEWDV01, LIWDV01) == 1, na.rm = TRUE) > 0)

```

Only two of those studying primary school teaching in 2003 LSAY were school leavers. However both seemed to have return back to school to complete.

What year level were these two when they left (cross-check to determine if its one year)

2999 & 10049 (leavers)

```{r}
# closer look at the school leavers (year and level)
school_leavers_year_level <- LSAY2003 %>% 
  filter(STIDSTD %in% c(2999, 10049)) %>% 
  select(STIDSTD, LBB001, LCB001, LDB001, LEB001, LEA005, LFB001, LFA006)
school_leavers_year_level
```

Both left in year 11.

```{r}
school_leavers_year <- LSAY2003 %>% 
  filter(STIDSTD %in% c(2999, 10049)) %>% 
  select(STIDSTD, LBA002B, LCA002B, LDA002B, LEA002B, LFA002Y)
school_leavers_year
```

2999 LEFT IN 2003, 10049 LEFT IN 2004. \* 2999 left in 2003 then went back to complete year 12 in 2005 \* 10049 left in 2004 and then went back to complete year 12 in 2005.

# PISA PVs

-   Determine the percentage of primary teachers in the sample below the National proficient standard

-   Determine the average achievement of primary teachers in the sample (in PISA points)

```{r}
# understanding PVs (exploratory understanding)
library(intsvy)
pisa.mean.pv(pvlabel = paste0("PV", 1:5, "MATH"), by = "STATEID", data = LSAY2003) #1:5 will have to be amended to 10 post 2015
# calculate average mathematics score by state PV1MATH - PV5MATH
```

1 = ACT, 2 = NSW, 3 = VIC, 4 = QLD, 5 = SA, 6 = WA, 7 = TAS, 8 = NT

https://www.acer.org/files/PISA_screen.pdf

" In mathematical literacy, the average performance of students in the Australian Capital Territory was significantly higher than the average achieved by students in New South Wales, Queensland, Victoria, Tasmania and the Northern Territory, and students from the Australian Capital Territory, Western Australia, South Australia, New South Wales and Queensland attained a higher average score than students in the Northern Territory. However, the performance of students in Victoria and Tasmania was not significantly different from the performance of students in the Northern Territory. These differences are more pronounced than those in maths in PISA 2000, perhaps because this measure of mathematical literacy is better defined, being the focus of PISA 2003. "

https://www.oecd.org/pisa/data/httpoecdorgpisadatabase-instructions.htm#:\~:text=The%20R%20package%20intsvy%20allows,other%20formats%20directly%20into%20R.

```{r}


# include only PS teachers
teacher_ids <- UNIQUE_LEGIT_TEACHERS$STIDSTD
teacher_data <- LSAY2003[LSAY2003$STIDSTD %in% teacher_ids, ]

# survey options to handle strata with only one PSU
options(survey.lonely.psu = "adjust")

# create survey design object: stratification by schoolid? each obs independent
teacher_design <- svydesign(ids = ~1, strata = ~SCHOOLID, weights = ~W_FSTUWT, data = teacher_data)

# calc mean math scores for each PV
mean_pv1 <- svymean(~PV1MATH, teacher_design)
mean_pv2 <- svymean(~PV2MATH, teacher_design)
mean_pv3 <- svymean(~PV3MATH, teacher_design)
mean_pv4 <- svymean(~PV4MATH, teacher_design)
mean_pv5 <- svymean(~PV5MATH, teacher_design)

# extracting means
mean_pv1_val <- coef(mean_pv1)
mean_pv2_val <- coef(mean_pv2)
mean_pv3_val <- coef(mean_pv3)
mean_pv4_val <- coef(mean_pv4)
mean_pv5_val <- coef(mean_pv5)

# overall mean score
overall_mean_math_pv <- mean(c(mean_pv1_val, mean_pv2_val, mean_pv3_val, mean_pv4_val, mean_pv5_val))

overall_mean_math_pv

#histograms
#hist(teacher_data$PV1MATH, main = "Histogram of PV1MATH", xlab = "PV1MATH") 
 # abline(v = mean(teacher_data$PV1MATH), col = "red")
  
#hist(teacher_data$W_FSTUWT, main = "Histogram of PV1MATH", xlab = "PV1MATH") 
  #abline(v = mean(teacher_data$PV1MATH), col = "red")

```

```{r}
# fact checking to see if survey gives similar results to intsvy package

# survey options to handle strata with only one PSU
options(survey.lonely.psu = "adjust")

# create survey design object: stratification by schoolid? each obs independent
teacher_design <- svydesign(ids = ~1, strata = ~SCHOOLID, weights = ~W_FSTUWT, data = LSAY2003)

# calc mean math scores for each PV
mean_pv1 <- svymean(~PV1MATH, teacher_design)
mean_pv2 <- svymean(~PV2MATH, teacher_design)
mean_pv3 <- svymean(~PV3MATH, teacher_design)
mean_pv4 <- svymean(~PV4MATH, teacher_design)
mean_pv5 <- svymean(~PV5MATH, teacher_design)

# extracting means
mean_pv1_val <- coef(mean_pv1)
mean_pv2_val <- coef(mean_pv2)
mean_pv3_val <- coef(mean_pv3)
mean_pv4_val <- coef(mean_pv4)
mean_pv5_val <- coef(mean_pv5)

# overall mean score
overall_mean_math_pv <- mean(c(mean_pv1_val, mean_pv2_val, mean_pv3_val, mean_pv4_val, mean_pv5_val))


overall_mean_math_pv

# Using intsvy to get mean for school

pisa_means_intsvy <- pisa.mean.pv(pvlabel = paste0("PV", 1:5, "MATH"), by = "SCHOOLID", data = LSAY2003)
overall_school_mean <- mean(pisa_means_intsvy$Mean)


overall_mean_math_pv #using survey package method
overall_school_mean #using intsvy package method


```

There is a discrepancy between the two different methods. https://www.oecd.org/pisa/data/httpoecdorgpisadatabase-instructions.htm `instvy`

```{r}
options(survey.lonely.psu = "adjust")

# school-level stratification and student-level sampling
teacher_design <- svydesign(
  ids = ~SCHOOLID + STIDSTD,  # two-stage sampling: schools then students
  strata = ~STATEID + SECTOR,  # stratification variables as per tech report
  weights = ~W_FSTUWT,  # weights column in the data frame
  data = teacher_data, # teacher data frame
  nest = TRUE  
)

# mean math scores for each plausible value
mean_pv1 <- svymean(~PV1MATH, teacher_design)
mean_pv2 <- svymean(~PV2MATH, teacher_design)
mean_pv3 <- svymean(~PV3MATH, teacher_design)
mean_pv4 <- svymean(~PV4MATH, teacher_design)
mean_pv5 <- svymean(~PV5MATH, teacher_design)

# taking only the means
mean_pv1_val <- coef(mean_pv1)
mean_pv2_val <- coef(mean_pv2)
mean_pv3_val <- coef(mean_pv3)
mean_pv4_val <- coef(mean_pv4)
mean_pv5_val <- coef(mean_pv5)

# finding the overall mean score by averaging all the means of PVs
overall_mean_math_pv <- mean(c(mean_pv1_val, mean_pv2_val, mean_pv3_val, mean_pv4_val, mean_pv5_val))

# average math score for teachers
overall_mean_math_pv

```

http://software-tecnico-libre.es/en/article-by-topic/all_sections/all-topics/all-articles/pisa-data-analytics-plausible-values "When we perform any calculations involving the plausible values, the procedure is always the same, we compute separately with each of the five values and, finally, we perform the mean of the five results, either regression coefficients, means, correlation coefficients, or any other estimator." --\> we assume survey package is handling the weights in the set up --\> so in some instances STIDSTD (e.g.) could have multiple observations within it, which is why we need to do the double mean

```{r}
library(survey)

# mean math scores for each teacher across each pv first
mean_pv1_by_teacher <- svyby(~PV1MATH, ~STIDSTD, teacher_design, svymean)
mean_pv2_by_teacher <- svyby(~PV2MATH, ~STIDSTD, teacher_design, svymean)
mean_pv3_by_teacher <- svyby(~PV3MATH, ~STIDSTD, teacher_design, svymean)
mean_pv4_by_teacher <- svyby(~PV4MATH, ~STIDSTD, teacher_design, svymean)
mean_pv5_by_teacher <- svyby(~PV5MATH, ~STIDSTD, teacher_design, svymean)

# creating a data frame with ID and mean for each PV for each ID
teacher_means <- data.frame(
  STIDSTD = mean_pv1_by_teacher$STIDSTD,
  mean_pv1 = mean_pv1_by_teacher$PV1MATH,
  mean_pv2 = mean_pv2_by_teacher$PV2MATH,
  mean_pv3 = mean_pv3_by_teacher$PV3MATH,
  mean_pv4 = mean_pv4_by_teacher$PV4MATH,
  mean_pv5 = mean_pv5_by_teacher$PV5MATH
)

# second average across the row for each teacher
teacher_means$mean_score = rowMeans(teacher_means[, -1])

threshold <- 549.5463 # average for teacher performance
proficient_standard <- 482 # level 3 proficient standard

# how many teachers are below teacher avg
teacher_means$below_avg_teacher = teacher_means$mean_score < threshold 

# how many teachers are below proficient standard (482)
teacher_means$below_prof_avg = teacher_means$mean_score < proficient_standard


```

```{r}
# seeing how many are below average -- true = below average (549.5463)
teachers_below_avg <- table(teacher_means$below_prof_avg)
teachers_below_avg
```

```{r}
# seeing how many are below proficient standard -- true = below proficient standard (482)
teachers_below_profstand <- table(teacher_means$below_prof_avg)
teachers_below_profstand
```

```{r}
# look at teacher_means and create possible row at the bottom w/ percentage above/below average

```

## Y06 LSAY

```{r}
LSAY2006 <- read_dta("data/lsay_data/au.edu.anu.ada.ddi.01137_v10.1_unrestricted.dta")
```

```{r}
# 2006 COHORT - exploring those who studied primary school teaching
STUDYING_TEACHERS_2006 <- LSAY2006 %>%
  # selecting variables for current area of study
  select(STIDSTD, LBC087, LCC087, LDC087, LEC087, LFC087, LGC088, LHC088, LIC088, LJC088, LKC088) %>%
  # Mutate across the observation to replace 0 = not '70103', 1 = is '70103'
  mutate(across(c(LBC087, LCC087, LDC087, LEC087, LFC087, LGC088, LHC088, LIC088, LJC088, LKC088),
                ~ case_when(
                   as.character(.) == '70103' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_, # Retain NA
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # Create new column where any 1 in the row = TRUE, no 1 = FALSE
  mutate(unique_teachers = if_any(c(LBC087, LCC087, LDC087, LEC087, LFC087, LGC088, LHC088, LIC088, LJC088, LKC088), ~ . == 1)) %>%
  # Keep TRUE values
  filter(unique_teachers)

STUDYING_TEACHERS_2006
```

```{r}
# Looking at people who were at the time working as PS Teachers

LEGIT_TEACHERS_2006 <- LSAY2006 %>%
  # Selecting variables for kind of work
  select(STIDSTD, LBD011, LCD024, LDD024, LED029, LFD029, LGD029, LHD029, LID029, LJD029, LKD029) %>%
  # Mutate across the observation 
  mutate(across(c(LBD011, LCD024, LDD024, LED029, LFD029, LGD029, LHD029, LID029, LJD029, LKD029),
                ~ case_when(
                   as.character(.) == '2412' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_,
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # column for TRUE = legit teachers, FALSE = not teachers
  mutate(legit_teachers = if_any(c(LBD011, LCD024, LDD024, LED029, LFD029, LGD029, LHD029, LID029, LJD029, LKD029), ~ . == 1)) %>%
  # Filter for TRUE condition
  filter(legit_teachers)

LEGIT_TEACHERS_2006
```

```{r}
# Taking a look at what the legit teachers studied
teacher_jobs <- LSAY2006[LSAY2006$STIDSTD %in% LEGIT_TEACHERS_2006$STIDSTD, ]

# selecting student ID and area of study across the years
selected_columns <- c('STIDSTD', 'LBC087', 'LCC087', 'LDC087', 'LEC087', 'LFC087', 'LGC088', 'LHC088', 'LIC088', 'LJC088', 'LKC088')
teacher_jobs <- teacher_jobs[, selected_columns]
```

+----------------------+---------------------------------------------+
| Code                 | Field                                       |
+======================+=============================================+
| 100705               | Written Communication                       |
+----------------------+---------------------------------------------+
| 100103               | Drama and Theatre Studies                   |
+----------------------+---------------------------------------------+
| 100101               | Music                                       |
+----------------------+---------------------------------------------+
| 80399                | Business and Management, n.e.c.             |
+----------------------+---------------------------------------------+
| 70103                | Teacher Education: Primary                  |
+----------------------+---------------------------------------------+
| 70101                | Teacher Education: Early Childhood          |
+----------------------+---------------------------------------------+
| 70105                | Teacher Education: Secondary                |
+----------------------+---------------------------------------------+
| 70199                | Teacher Education, n.e.c.                   |
+----------------------+---------------------------------------------+
| 91701                | Philosophy                                  |
+----------------------+---------------------------------------------+
| 60901                | Optometry                                   |
+----------------------+---------------------------------------------+
| 61399                | Public Health, n.e.c.                       |
+----------------------+---------------------------------------------+
| 60101                | General Medicine                            |
+----------------------+---------------------------------------------+
| 91703                | Religious Studies                           |
+----------------------+---------------------------------------------+
| 80101                | Accounting                                  |
+----------------------+---------------------------------------------+
| 81101                | Banking and Finance                         |
+----------------------+---------------------------------------------+
| 91523                | Literature                                  |
+----------------------+---------------------------------------------+
| 90513                | Counselling                                 |
+----------------------+---------------------------------------------+

```{r}
studying_teachers <- unique(STUDYING_TEACHERS_2006$STIDSTD)
# filter the LSAY2003 data for those IDs and high school leaving variables.
studying_teachers_y12 <- LSAY2006 %>% 
  filter(STIDSTD %in% studying_teachers) %>% 
  select(STIDSTD, LBWDV01, LCWDV01, LDWDV01, LEWDV01, LFWDV01) %>%
   mutate(Studying_Teacher = rowSums(select(., LBWDV01, LCWDV01, LDWDV01, LEWDV01, LFWDV01) == 1, na.rm = TRUE) > 0)
```

# PISA PVs

-   Determine the percentage of primary teachers in the sample below the National proficient standard

-   Determine the average achievement of primary teachers in the sample (in PISA points)

```{r}

teacher_ids <- LEGIT_TEACHERS_2006$STIDSTD
teacher_data_2006 <- LSAY2006[LSAY2006$STIDSTD %in% teacher_ids, ]


options(survey.lonely.psu = "adjust")

# school-level stratification and student-level sampling
teacher_design_y06 <- svydesign(
  ids = ~SCHOOLID + STIDSTD,  # two-stage sampling: schools then students
  strata = ~STATE + SECTOR,  # stratification variables as per tech report
  weights = ~W_FSTUWT,  # weights column in the data frame
  data = teacher_data_2006, # teacher data frame
  nest = TRUE  
)
```

```{r}
library(survey)

# mean math scores for each teacher across each pv first
mean_pv1_by_teacher <- svyby(~PV1MATH, ~STIDSTD, teacher_design_y06, svymean)
mean_pv2_by_teacher <- svyby(~PV2MATH, ~STIDSTD, teacher_design_y06, svymean)
mean_pv3_by_teacher <- svyby(~PV3MATH, ~STIDSTD, teacher_design_y06, svymean)
mean_pv4_by_teacher <- svyby(~PV4MATH, ~STIDSTD, teacher_design_y06, svymean)
mean_pv5_by_teacher <- svyby(~PV5MATH, ~STIDSTD, teacher_design_y06, svymean)

# creating a data frame with ID and mean for each PV for each ID
teacher_means_y06 <- data.frame(
  STIDSTD = mean_pv1_by_teacher$STIDSTD,
  mean_pv1 = mean_pv1_by_teacher$PV1MATH,
  mean_pv2 = mean_pv2_by_teacher$PV2MATH,
  mean_pv3 = mean_pv3_by_teacher$PV3MATH,
  mean_pv4 = mean_pv4_by_teacher$PV4MATH,
  mean_pv5 = mean_pv5_by_teacher$PV5MATH
)

# second average across the row for each teacher
teacher_means_y06$mean_score = rowMeans(teacher_means_y06[, -1])

proficient_standard <- 482 # level 3 proficient standard - **double check if this has changed**

# how many teachers are below proficient standard (482)
teacher_means_y06$below_prof_avg = teacher_means_y06$mean_score < proficient_standard


```

```{r}
# TRUE being below the 482 proficient standard (level 3)
teachers_below_profstand_y06 <- table(teacher_means_y06$below_prof_avg)
teachers_below_profstand_y06
```

# LSAY 2009

```{r}
# reading in 2009 data
LSAY2009 <- read_dta("data/lsay_data/au.edu.anu.ada.ddi.30023v9_unrestricted.dta")

```

```{r}
# 2009 COHORT - exploring those who studied primary school teaching
STUDYING_TEACHERS_2009 <- LSAY2009 %>%
  # selecting variables for current area of study
  select(STIDSTD, LBC089, LCC088, LDC088, LEC088, LFC088, LGC088, LHC088, LIC088, LJC088, LKC088) %>%
  # Mutate across the observation to replace 0 = not '70103', 1 = is '70103'
  mutate(across(c(LBC089, LCC088, LDC088, LEC088, LFC088, LGC088, LHC088, LIC088, LJC088, LKC088),
                ~ case_when(
                   as.character(.) == '70103' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_, # Retain NA
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # Create new column where any 1 in the row = TRUE, no 1 = FALSE
  mutate(unique_teachers = if_any(c(LBC089, LCC088, LDC088, LEC088, LFC088, LGC088, LHC088, LIC088, LJC088, LKC088), ~ . == 1)) %>%
  # Keep TRUE values
  filter(unique_teachers)

STUDYING_TEACHERS_2009
```

```{r}
# Looking at people who were at the time working as PS Teachers

LEGIT_TEACHERS_2009 <- LSAY2009 %>%
  # Selecting variables for kind of work
  select(STIDSTD, LBD014, LCD029, LDD029, LED029, LFD029, LGD029, LHD029, LID029, LJD029, LKD029) %>%
  # Mutate across the observation 
  mutate(across(c(LBD014, LCD029, LDD029, LED029, LFD029, LGD029, LHD029, LID029, LJD029, LKD029),
                ~ case_when(
                   as.character(.) == '2412' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_,
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # column for TRUE = legit teachers, FALSE = not teachers
  mutate(legit_teachers = if_any(c(LBD014, LCD029, LDD029, LED029, LFD029, LGD029, LHD029, LID029, LJD029, LKD029), ~ . == 1)) %>%
  # Filter for TRUE condition
  filter(legit_teachers)

LEGIT_TEACHERS_2009
```

```{r}
# Taking a look at what the legit teachers studied
teacher_jobs_2009 <- LSAY2009[LSAY2009$STIDSTD %in% LEGIT_TEACHERS_2009$STIDSTD, ]

# selecting student ID and area of study across the years
selected_columns <- c('STIDSTD', 'LBC089', 'LCC088', 'LDC088', 'LEC088', 'LFC088', 'LGC088', 'LHC088', 'LIC088', 'LJC088', 'LKC088')
teacher_jobs_2009 <- teacher_jobs_2009[, selected_columns]
```

What did they study?

+--------------------+-------------------------------------------------+
| Code               | Field                                           |
+====================+=================================================+
| 90701              | Psychology                                      |
+--------------------+-------------------------------------------------+
| 70199              | Teacher Education, n.e.c.                       |
+--------------------+-------------------------------------------------+
| 79999              | Education, n.e.c.                               |
+--------------------+-------------------------------------------------+
| 90503              | Children's Services                             |
+--------------------+-------------------------------------------------+
| 60501              | Pharmacy                                        |
+--------------------+-------------------------------------------------+
| 70103              | Teacher Education: Primary                      |
+--------------------+-------------------------------------------------+
| 70105              | Teacher Education: Secondary                    |
+--------------------+-------------------------------------------------+
| 61799              | Rehabilitation Therapies, n.e.c.                |
+--------------------+-------------------------------------------------+

** revisit -- have to do proficiency standard **


# LSAY 2015

```{r}
LSAY2015 <- read_dta("data/lsay_data/2_LSAY_Y15_2022_STATA_01392_general.dta")
```


```{r}
# 2009 COHORT - exploring those who studied primary school teaching
STUDYING_TEACHERS_2015 <- LSAY2015 %>%
  # selecting variables for current area of study
  select(LSAYID, LCC088, LDC088, LEC088, LFC088, LGC088, LHC088) %>%
  # Mutate across the observation to replace 0 = not '70103', 1 = is '70103'
  mutate(across(c(LCC088, LDC088, LEC088, LFC088, LGC088, LHC088),
                ~ case_when(
                   as.character(.) == '70103' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_, # Retain NA
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # Create new column where any 1 in the row = TRUE, no 1 = FALSE
  mutate(unique_teachers = if_any(c(LCC088, LDC088, LEC088, LFC088, LGC088, LHC088), ~ . == 1)) %>%
  # Keep TRUE values
  filter(unique_teachers)

STUDYING_TEACHERS_2015
```

```{r}
# Looking at people who were at the time working as PS Teachers

LEGIT_TEACHERS_2015 <- LSAY2015 %>%
  # Selecting variables for kind of work
  select(LSAYID, LBEM004, LCD022, LDD022, LED022, LFD025, LGD022, LHD022) %>%
  # Mutate across the observation 
  mutate(across(c(LBEM004, LCD022, LDD022, LED022, LFD025, LGD022, LHD022),
                ~ case_when(
                   as.character(.) == '2412' ~ 1,  # PSE as 1
                   is.na(.) ~ NA_integer_,
                   TRUE ~ 0  # All else as 0
                 ))) %>%
  # column for TRUE = legit teachers, FALSE = not teachers
  mutate(legit_teachers = if_any(c(LBEM004, LCD022, LDD022, LED022, LFD025, LGD022, LHD022), ~ . == 1)) %>%
  # Filter for TRUE condition
  filter(legit_teachers)

LEGIT_TEACHERS_2015
```

```{r}
# Taking a look at what the legit teachers studied
teacher_jobs_2015 <- LSAY2015[LSAY2015$LSAYID %in% LEGIT_TEACHERS_2015$LSAYID, ]

# selecting student ID and area of study across the years
selected_columns <- c('LSAYID', 'LCC088', 'LDC088', 'LEC088', 'LFC088', 'LGC088', 'LHC088')
teacher_jobs_2015 <- teacher_jobs_2015[, selected_columns]
```


---
title: "Teachers' attitudes towards maths"
author: "Nick Parkinson"
date: "18 July 2024"
format: 
  html:
    css: .formatting/grattan-style.css
    theme: lumen
    highlight: pygments
    toc: true
    toc_depth: 2
    number_sections: yes
    df_print: kable
    fig-cap-location: top
execute:
  echo: false
  warning: false
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r}
#| label: set-up
#| include: false

source("R/globals.R")
load(file = "data/clean_survey.Rdata")
```

How many teachers studied maths in Year 12?

```{r}
#| label: y-12-maths
clean_survey |> 
  drop_na(Q13) |> 
  tabulator::tab(Q13)
```

How many teachers studied maths in higher education?

```{r}
#| label: uni-maths
clean_survey |> 
  drop_na(Q14) |> 
  tabulator::tab(Q14)
```

How confident do teachers feel about maths?

```{r}
teacher_confidence_labels <- clean_survey |> 
  select(Q38_1:Q38_8) |> 
  var_labels() |> 
  get_label() |> 
  str_replace_all(c("attitudes_to_maths - " = "",
                  "\\s*\\([^\\)]+\\)" = ""))

teacher_confidence_df <- clean_survey |>
  select(Q38_1:Q38_8) |> 
  mutate(across(starts_with("Q38"), ~ case_when(
    . == "Agree" ~ T,
    . == "Strongly agree" ~ T,
    is.na(.) ~ NA,
    .default = F
  ))) |> 
  pivot_longer(everything(), names_to = "question", values_to = "response") |> 
  group_by(question) |> 
  summarise(mean = mean(response, na.rm = T), 
            se = sd(response, na.rm = T)  / sqrt(sum(!is.na(response)))) |> 
  mutate(label = teacher_confidence_labels)

teacher_confidence_df |> 
  ggplot(aes(x = factor(str_wrap(label, 40)) |> fct_reorder(mean),
             y = mean, 
             ymin = mean - 1.65 * se, 
             ymax = mean + 1.65 * se)) +
  geom_col() +
  geom_errorbar(color = grattan_black,
                width = .2) +
  coord_flip() +
  # theme and labels
  theme_grattan(flipped = T,
                base_size = 14) +
  grattan_y_continuous(labels = percent)
 
```

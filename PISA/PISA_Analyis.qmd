---
title: "PISA"
format: html
editor: visual
---

## PISA ANALYSIS

```{r}
library(haven)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(grattantheme)
library(glue)
library(officer)
library(ggtext)
library(Rrepest)
library(intsvy)
library(EdSurvey) #install.packages("EdSurvey")
# reading sav file
PISA2000 <- read_sav("data/CY01_AUS_PISA2000_StdQ_Achieve_and_SchQ_forPublic_Release.sav")
PISA2003 <- read_sav("data/CY02_AUS_PISA2003_StdQ_AchieveandSchQ_forPublic_Release.sav")
PISA2006 <- read_sav("data/CY03_AUS_PISA2006_StdQAchieve andSchQ_forPublicRelease.sav")
PISA2009_1 <- read_sav("data/PISA2009_ScQ_AUS_release.sav") #need to check
PISA2009_2 <- read_sav("data/PISA2009_StQ_AUS_release.sav") #need to check, has math vals
PISA2012 <- read_sav("data/PISA2012_StdQ_AUS.sav")
PISA2015 <- read_sav("data/CY6_MS_AUS_PISA2015_StudentandAchievementforPublicRelease.sav")
PISA2018 <- read_sav("data/CY7_MS_AUS_PISA2018_StudentandAchievement_PublicRelease.sav")
PISA2022 <- read_sav("data/CY08_MS_AUS_PISA 2022_Student_and_Achievement_Public.sav")

# alternative #1
# options(HTTPUserAgent = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0")
# downloadPISA(root = "~/", years = c(2003, 2006, 2009, 2012, 2015, 2018))
# pisa2003 <- readPISA(path = "data/PISA/2000", database = "INT", countries = "aus", cognitive = "score")

# alternative #2
# PISA_2003_alternative <-  pisa.select.merge(folder = "data/",
#                                             student.file ="CY02_AUS_PISA2003_StdQ_AchieveandSchQ_forPublic_Release.sav",
#                                             student = c("ST01Q01"),
#                                             countries = c("AUS"))
```

Monday: PISA

**Download PISA data from ACER website and save to shared folder (2 hr)**

DONE the first

**Import each dataset (1 hr)**

DONE, except 2015 which didn't download.

**Filter for Year 10s (1hr)**

Looking for variable ST001D01T: 10

```{r}
# taking all the year 10s out of PISA 2000
PISA2000_Y10 <- PISA2000 %>% filter(st02q01 == 10)

# taking all the year 10s out of PISA 2003
PISA2003_Y10 <- PISA2003 %>% filter(ST01Q01 == 10)

# taking all the year 10s out of PISA 2006
PISA2006_Y10 <- PISA2006 %>% filter(ST01Q01 == 10)

# taking all the year 10s out of PISA 2009
PISA2009_2_Y10 <- PISA2009_2 %>% filter(ST01Q01 == 10)

# taking all the year 10s out of PISA 2012
PISA2012_Y10 <- PISA2012 %>% filter(ST01Q01 == 10)

PISA_2015_Y10 <- PISA2015 %>% filter(ST001D01T == 10)

# taking all the year 10s out of PISA 2018
PISA2018_Y10 <- PISA2018 %>% filter(ST001D01T == 10)

# taking all the year 10s out of PISA 2022
PISA2022_Y10 <- PISA2022 %>% filter(ST001D01T == 10)

# cleaning names

PISA2018_Y10 <- janitor::clean_names(PISA2018_Y10)
PISA_2015_Y10 <- janitor::clean_names(PISA_2015_Y10)
PISA2022_Y10 <- janitor::clean_names(PISA2022_Y10)

```

Get Mean + Confidence Interval for each year in literacy and numeracy (1 hr)

```{r}

# Average Maths Scores for Y10s Across the Years
#2000
# PISA did not test maths in 2000. I can't quite understand why this is here.
# Looks like maths was tested in 2000, but that data shouldn't be used as it wasn't a major domain until 2003. 
means_2000 <- Rrepest(data = PISA2000_Y10, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
# The mean values here are different to those reported by ACER here. https://www.acer.org/au/discover/article/the-effect-of-year-level-on-pisa-achievement.
means_2003 <- Rrepest(data = PISA2003, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)),
        by = "ST01Q01")

names(PISA2003) <- toupper(names(PISA2003))

# PISA2003 <- 
#   PISA2003 |> 
#   mutate(grade_category = case_when(
#     ST01Q01 == 10 ~ '10',
#     between(ST01Q01, 7, 9) ~ '<10',
#     between(ST01Q01, 11, 12) ~ '>10',
#     TRUE ~ NA
#   ))

# Values slightly different from Ainley
means_2003_new <- pisa.mean.pv(
  pvlabel = paste0("PV", 1:5, "MATH"),
  by = "ST01Q01",
  data = PISA2003
)

#2006
means_2006 <- Rrepest(data = PISA2006_Y10, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80))
        )

means_2006_new <- pisa.mean.pv(
  pvlabel = paste0("PV", 1:5, "MATH"),
  by = "ST01Q01",
  data = PISA2006
)

#2009
means_2009 <- Rrepest(data = PISA2009_2_Y10, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@math"),
       cm.weights = c(paste0("w_fstr", 1:80)))

means_2009_new <- pisa.mean.pv(
  pvlabel = paste0("PV", 1:5, "MATH"),
  by = "ST01Q01",
  data = PISA2009_2
)

#2012
means_2012 <- Rrepest(data = PISA2012_Y10, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        by = "ST001D01T",
        cm.weights = c(paste0("w_fstr", 1:80)))

means_2012_new <- pisa.mean.pv(
  pvlabel = paste0("PV", 1:5, "MATH"),
  by = "ST01Q01",
  data = PISA2012
)

#2015
means_2015 <- Rrepest(data = PISA_2015_Y10, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt",1:80)))

means_2015_new <- pisa.mean.pv(
  pvlabel = paste0("PV", 1:10, "MATH"),
  by = "ST001D01T",
  data = PISA2015
)

#2018
means_2018 <- Rrepest(data = PISA2018_Y10, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

means_2018_new <- pisa.mean.pv(
  pvlabel = paste0("PV", 1:10, "MATH"),
  by = "ST001D01T",
  data = PISA2018
)

#2022
means_2022 <- Rrepest(data = PISA2022_Y10, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

means_2022_new <- pisa.mean.pv(
  pvlabel = paste0("PV", 1:10, "MATH"),
  by = "ST001D01T",
  data = PISA2022
)

# making dataframe for year 10 math
# Add Year column
means_2000$Year <- 2000
means_2003$Year <- 2003
means_2006$Year <- 2006
means_2009$Year <- 2009
means_2012$Year <- 2012
means_2015$Year <- 2015
means_2018$Year <- 2018
means_2022$Year <- 2022

# Add Year column
means_2003_new$Year <- 2003
means_2006_new$Year <- 2006
means_2009_new$Year <- 2009
means_2012_new$Year <- 2012
means_2015_new$Year <- 2015
means_2018_new$Year <- 2018
means_2022_new$Year <- 2022

all_means <- rbind(
  means_2000,
  means_2003,
  means_2006,
  means_2009,
  means_2012,
  means_2015,
  means_2018,
  means_2022
)

all_means_new <- bind_rows(
  means_2003_new,
  means_2006_new,
  means_2009_new,
  means_2012_new,
  means_2015_new,
  means_2018_new,
  means_2022_new, 
)

all_means$CI_Lower <- all_means$`b.mean.pv@math` - 1.96 * all_means$`se.mean.pv@math`
all_means$CI_Upper <- all_means$`b.mean.pv@math` + 1.96 * all_means$`se.mean.pv@math`
all_means_new$CI_Lower <- all_means_new$Mean - 1.96 * all_means_new$s.e.
all_means_new$CI_Upper <- all_means_new$Mean + 1.96 * all_means_new$s.e.

PISA_means <- all_means[, c("Year", ".", "b.mean.pv@math", "se.mean.pv@math", "b.std.pv@math", "se.std.pv@math", "CI_Lower", "CI_Upper")]


```

```{r}
# Creating math mean dataframe and confidence intervals for the general public in the dataset
#2000
genpop_means_2000 <- Rrepest(data = PISA2000, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
genpop_means_2003 <- Rrepest(data = PISA2003, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
genpop_means_2006 <- Rrepest(data = PISA2006, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
genpop_means_2009 <- Rrepest(data = PISA2009_2, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@math"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
genpop_means_2012 <- Rrepest(data = PISA2012, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
genpop_means_2015 <- Rrepest(data = PISA2015, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
genpop_means_2018 <- Rrepest(data = PISA2018, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
genpop_means_2022 <- Rrepest(data = PISA2022, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

#combing the dataframes for gen pop avg and conf int
#adding year column
genpop_means_2000$Year <- 2000
genpop_means_2003$Year <- 2003
genpop_means_2006$Year <- 2006
genpop_means_2009$Year <- 2009
genpop_means_2012$Year <- 2012
genpop_means_2015$Year <- 2015
genpop_means_2018$Year <- 2018
genpop_means_2022$Year <- 2022

genpop_all_means <- rbind(
  genpop_means_2000,
  genpop_means_2003,
  genpop_means_2006,
  genpop_means_2009,
  genpop_means_2012,
  genpop_means_2015,
  genpop_means_2018,
  genpop_means_2022
)

genpop_all_means$CI_Lower <- genpop_all_means$`b.mean.pv@math` - 1.96 * genpop_all_means$`se.mean.pv@math`
genpop_all_means$CI_Upper <- genpop_all_means$`b.mean.pv@math` + 1.96 * genpop_all_means$`se.mean.pv@math`

genpop_PISA_means <- genpop_all_means[, c("Year", ".", "b.mean.pv@math", "se.mean.pv@math", "b.std.pv@math", "se.std.pv@math", "CI_Lower", "CI_Upper")]


```

## Creating dataframe for year 10 literacy

```{r}
# Average Literacy Scores for Y10s Across the Years
#2000
readmeans_2000 <- Rrepest(data = PISA2000_Y10, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
readmeans_2003 <- Rrepest(data = PISA2003_Y10, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
readmeans_2006 <- Rrepest(data = PISA2006_Y10, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
readmeans_2009 <- Rrepest(data = PISA2009_2_Y10, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@read"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
readmeans_2012 <- Rrepest(data = PISA2012_Y10, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
readmeans_2015 <- Rrepest(data = PISA_2015_Y10, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
readmeans_2018 <- Rrepest(data = PISA2018_Y10, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
readmeans_2022 <- Rrepest(data = PISA2022_Y10, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

```

```{r}
# Add Year column
readmeans_2000$Year <- 2000
readmeans_2003$Year <- 2003
readmeans_2006$Year <- 2006
readmeans_2009$Year <- 2009
readmeans_2012$Year <- 2012
readmeans_2015$Year <- 2015
readmeans_2018$Year <- 2018
readmeans_2022$Year <- 2022

all_readmeans <- rbind(
  readmeans_2000,
  readmeans_2003,
  readmeans_2006,
  readmeans_2009,
  readmeans_2012,
  readmeans_2015,
  readmeans_2018,
  readmeans_2022
)


all_readmeans$CI_Lower <- all_readmeans$`b.mean.pv@read` - 1.96 * all_readmeans$`se.mean.pv@read`
all_readmeans$CI_Upper <- all_readmeans$`b.mean.pv@read` + 1.96 * all_readmeans$`se.mean.pv@read`

PISA_readmeans <- all_readmeans[, c("Year", ".", "b.mean.pv@read", "se.mean.pv@read", "b.std.pv@read", "se.std.pv@read", "CI_Lower", "CI_Upper")]
```

```{r}
# creating dataframe for literacy for general population
# Creating math mean dataframe and confidence intervals for the general public in the dataset
#2000
genpop_read_means_2000 <- Rrepest(data = PISA2000, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
genpop_read_means_2003 <- Rrepest(data = PISA2003, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
genpop_read_means_2006 <- Rrepest(data = PISA2006, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
genpop_read_means_2009 <- Rrepest(data = PISA2009_2, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@read"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
genpop_read_means_2012 <- Rrepest(data = PISA2012, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
genpop_read_means_2015 <- Rrepest(data = PISA2015, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
genpop_read_means_2018 <- Rrepest(data = PISA2018, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
genpop_read_means_2022 <- Rrepest(data = PISA2022, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

#combing the dataframes for gen pop avg and conf int
#adding year column
genpop_read_means_2000$Year <- 2000
genpop_read_means_2003$Year <- 2003
genpop_read_means_2006$Year <- 2006
genpop_read_means_2009$Year <- 2009
genpop_read_means_2012$Year <- 2012
genpop_read_means_2015$Year <- 2015
genpop_read_means_2018$Year <- 2018
genpop_read_means_2022$Year <- 2022

genpop_read_all_means <- rbind(
  genpop_read_means_2000,
  genpop_read_means_2003,
  genpop_read_means_2006,
  genpop_read_means_2009,
  genpop_read_means_2012,
  genpop_read_means_2015,
  genpop_read_means_2018,
  genpop_read_means_2022
)

genpop_read_all_means$CI_Lower <- genpop_read_all_means$`b.mean.pv@read` - 1.96 * genpop_read_all_means$`se.mean.pv@read`
genpop_read_all_means$CI_Upper <- genpop_read_all_means$`b.mean.pv@read` + 1.96 * genpop_read_all_means$`se.mean.pv@read`

genpop_PISA_read_means <- genpop_read_all_means[, c("Year", ".", "b.mean.pv@read", "se.mean.pv@read", "b.std.pv@read", "se.std.pv@read", "CI_Lower", "CI_Upper")]

```

Create national line charts for Y10 literacy and numeracy (2 hr) - version take numbers out - 1.8 annotation decline represents 'decrease of this much' - decline is however many years of learning: most re - check into 2018 - 2022 delay, pisa sitting (2018 and 2022 pisa gap) timing of 2022 test - all students vs year 10 only

```{r}
# chart for year 10 numeracy w/ general population
yr10scores_ci <- ggplot(PISA_means, aes(x = Year, y = `b.mean.pv@math`)) +
  geom_point() +
  geom_line(data = subset(PISA_means, Year <= 2018)) +  
  geom_line(data = subset(PISA_means, Year >= 2022)) +  
  geom_errorbar(aes(ymin = CI_Lower, ymax = CI_Upper), width = 0) + 
  scale_x_continuous(breaks = all_means$Year) + 
  labs(title = "Year 10's mathematics scores have been declining over the years",
       subtitle = glue("Average {colour_text('#FF0000','PISA scores')} and {colour_text(grattan_orange, 'confidence intervals')} for year 10s across the years")) +
  theme_minimal()

#overlapping, adding points/amending error bars to match grattan style
yr10scores_ci +
  geom_line(data = subset(genpop_PISA_means, Year <= 2018), 
            aes(x = Year, y = `b.mean.pv@math`), 
            color = "darkred", linetype = "solid", size = 1, alpha = 0.7) +  
  geom_point(data = subset(genpop_PISA_means, Year <= 2018), 
             aes(x = Year, y = `b.mean.pv@math`), 
             color = "darkred", size = 2, alpha = 0.7) + 
  geom_point(data = subset(genpop_PISA_means, Year == 2022), 
             aes(x = Year, y = `b.mean.pv@math`), 
             color = "darkred", size = 2, alpha = 0.7) +  
  geom_point(data = subset(PISA_means, Year == 2022), 
             aes(x = Year, y = `b.mean.pv@math`), 
             color = "orange", size = 2, alpha = 0.7) + 
  theme_grattan(chart_type = "line") +
  grattan_colour_manual(2, faded_level = 2) +
  theme(axis.line = element_line(colour = "grey80")) +
  grattan_y_continuous() +
  theme(plot.subtitle = element_markdown(lineheight = 1.1)) +
  annotate(geom = "rect", xmin = 2018, xmax = 2022, ymin = -Inf, ymax = Inf, 
           fill = "lightgrey", alpha = 0.2, color = NA) + 
  annotate("text", x = 2020, y = 500, label = "1 Year Delay Due to COVID-19", 
           size = 4, color = "black", angle = 90, hjust = 0.5) +
  # arrow and annotation
  #annotate("segment", x = 2006, xend = 2004, y = 530, yend = 526, 
           #arrow = arrow(length = unit(0.3, "cm")), color = "darkred", size = 0.5) +
  annotate("text", x = 2006.2, y = 531, label = "PISA Population Average", 
           hjust = 0, color = "darkred", size = 4)

# chart for year 10 numeracy (Nick's version)
yr10scores_ci_new <- 
  all_means_new |> 
  filter(ST01Q01 == 10 | ST001D01T == 10) |> 
  mutate(gap = (max(Mean) - min(Mean))/20*12) |> 
  ggplot(aes(x = Year, y = Mean)) +
  geom_ribbon(aes(ymin = CI_Lower, ymax = CI_Upper), 
              fill = grattan_orange_alpha, 
              color = NA) +
  geom_point() +
  geom_line() +
  scale_x_continuous(breaks = unique(all_means_new$Year)) + 
  labs(title = "Year 10's mathematics scores have been declining over the years",
       subtitle = glue("Average Australian Year 10 PISA score in Mathematical Literacy and 95 per cent confidence interval"),
       x = NULL) +
  theme_grattan() +
  grattan_y_continuous() +
  theme(plot.subtitle = element_markdown(lineheight = 1.1)) +
  geom_curve(aes(x = 2019, 
                   y = 507, 
                   xend = 2022, 
                   yend = min(Mean)+2),
             curvature = -0.3,
 arrow = grattan_arrow(),
 colour = grattan_grey_title) +
  geom_richtext(data = . %>% last(), 
                aes(label = glue("<i>Year 10s in 2022<br>were about <b>{round(gap)} months<br>of learning</b> behind<br> their 2003 peers</i>"), 
                    x = 2015, 
                    y = 500),
                vjust = -.5, 
                hjust = "left",
                colour = grattan_grey_title,
                label.colour = NA,
                size = 18/.pt) 


grattan_save_all(filename = "atlas/pisa_2003_2022_y10_maths.pdf")


```

```{r}
# chart for year 10 literacy w/ general population
yr10litscores_ci <- ggplot(PISA_readmeans, aes(x = Year, y = `b.mean.pv@read`)) +
  geom_point() +
  geom_line(data = subset(PISA_readmeans, Year <= 2018)) +  
  geom_line(data = subset(PISA_readmeans, Year >= 2022)) +  
  geom_errorbar(aes(ymin = CI_Lower, ymax = CI_Upper), width = 0) + 
  scale_x_continuous(breaks = all_readmeans$Year) + 
  labs(title = "Year 10's literacy scores have been declining over the years",
       subtitle = glue("Average {colour_text('#FF0000','PISA scores')} and {colour_text(grattan_orange, 'confidence intervals')} for year 10s across the years"),
       x = "Year") +
  theme_minimal()

#overlapping, adding points/amending error bars to match grattan style
yr10litscores_ci +
  geom_line(data = subset(genpop_PISA_read_means, Year <= 2018), 
            aes(x = Year, y = `b.mean.pv@read`), 
            color = "darkred", linetype = "solid", size = 1, alpha = 0.7) +  
  geom_point(data = subset(genpop_PISA_read_means, Year <= 2018), 
             aes(x = Year, y = `b.mean.pv@read`), 
             color = "darkred", size = 2, alpha = 0.7) + 
  geom_point(data = subset(genpop_PISA_read_means, Year == 2022), 
             aes(x = Year, y = `b.mean.pv@read`), 
             color = "darkred", size = 2, alpha = 0.7) +  
  geom_point(data = subset(PISA_readmeans, Year == 2022), 
             aes(x = Year, y = `b.mean.pv@read`), 
             color = "orange", size = 2, alpha = 0.7) + 
  theme_grattan(chart_type = "line") +
  grattan_colour_manual(2, faded_level = 2) +
  theme(axis.line = element_line(colour = "grey80")) +
  grattan_y_continuous() +
  theme(plot.subtitle = element_markdown(lineheight = 1.1)) +
  annotate(geom = "rect", xmin = 2018, xmax = 2022, ymin = -Inf, ymax = Inf, 
           fill = "lightgrey", alpha = 0.2, color = NA) + 
  annotate("text", x = 2020, y = 510, label = "1 Year Delay Due to COVID-19", 
           size = 4, color = "black", angle = 90, hjust = 0.5) 
```

# Making charts now filtering just for each state and territory and for the Catholics (National, Victoria and NSW)

(May need to doule check) 1 - NSW 2 - VIC 3- QLD 4- SA 5- WA 6 - TAS 7 - NT 8 - ACT

## FOR VICTORIA

PISA 2012 seems to only have 'STRATUM' instead of STATE - would have to filter for the states using this variable. View [page 9](https://www.oecd.org/content/dam/oecd/en/data/datasets/pisa/pisa-2012-datasets/main-survey/codebooks/Codebook%20for%20student%20questionnaire%20data%20file.pdf)

```{r}
# Making charts just for Victoria vs General population - Maths
# DATA Pre-processing:
# taking all the VIC out of PISA 2000
PISA2000_vic <- PISA2000 %>% filter(State == 2)

# taking all the VIC out of PISA 2003
PISA2003_vic <- PISA2003 %>% filter(State == 2)

# taking all the VIC out of PISA 2006
PISA2006_vic <- PISA2006 %>% filter(as.numeric(as_factor(State)) == 2)

# taking all the VIC out of PISA 2009
PISA2009_2_vic <- PISA2009_2 %>% filter(STATE == 2)

# taking all the VIC out of PISA 2012
PISA2012_vic <- PISA2012 %>% filter(STRATUM %in% c('AUS0307', 'AUS0308', 'AUS0309')) #For VICTORIAN schools

PISA_2015_vic <- PISA2015 %>% filter(State == 2)

# taking all the VIC out of PISA 2018
PISA2018_vic <- PISA2018 %>% filter(State == 2)

# taking all the VIC out of PISA 2022
PISA2022_vic <- PISA2022 %>% filter(State == 2)

# cleaning names
PISA2018_vic <- janitor::clean_names(PISA2018_vic)
PISA_2015_vic <- janitor::clean_names(PISA_2015_vic)
PISA2022_vic <- janitor::clean_names(PISA2022_vic)



```

Problems: finding states for 2012 - have to use STRATUM variable instead

```{r}

# Average Maths Scores for Y10s Across the Years
#2000
vic_mathmeans_2000 <- Rrepest(data = PISA2000_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
vic_mathmeans_2003 <- Rrepest(data = PISA2003_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
vic_mathmeans_2006 <- Rrepest(data = PISA2006_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
vic_mathmeans_2009 <- Rrepest(data = PISA2009_2_vic, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@math"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
vic_mathmeans_2012 <- Rrepest(data = PISA2012_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
vic_mathmeans_2015 <- Rrepest(data = PISA_2015_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
vic_mathmeans_2018 <- Rrepest(data = PISA2018_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
vic_mathmeans_2022 <- Rrepest(data = PISA2022_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

# making dataframe for year 10 math
# Add Year column
vic_mathmeans_2000$Year <- 2000
vic_mathmeans_2003$Year <- 2003
vic_mathmeans_2006$Year <- 2006
vic_mathmeans_2009$Year <- 2009
vic_mathmeans_2012$Year <- 2012
vic_mathmeans_2015$Year <- 2015
vic_mathmeans_2018$Year <- 2018
vic_mathmeans_2022$Year <- 2022

vic_math_means <- rbind(
  vic_mathmeans_2000,
  vic_mathmeans_2003,
  vic_mathmeans_2006,
  vic_mathmeans_2009,
  vic_mathmeans_2012,
  vic_mathmeans_2015,
  vic_mathmeans_2018,
  vic_mathmeans_2022
)


vic_math_means$CI_Lower <- vic_math_means$`b.mean.pv@math` - 1.96 * vic_math_means$`se.mean.pv@math`
vic_math_means$CI_Upper <- vic_math_means$`b.mean.pv@math` + 1.96 * vic_math_means$`se.mean.pv@math`

vic_PISA_mathmeans <- vic_math_means[, c("Year", ".", "b.mean.pv@math", "se.mean.pv@math", "b.std.pv@math", "se.std.pv@math", "CI_Lower", "CI_Upper")]


```

## FOR NSW

```{r}
# Making charts just for NSW vs General population - Maths
# DATA Pre-processing:
# taking all the NSW students/schools out of PISA 2000
PISA2000_nsw <- PISA2000 %>% filter(State == 1)

# taking all the year 10s out of PISA 2003
PISA2003_nsw <- PISA2003 %>% filter(State == 1)

# taking all the year 10s out of PISA 2006
PISA2006_nsw <- PISA2006 %>% filter(as.numeric(as_factor(State)) == 1)

# taking all the year 10s out of PISA 2009
PISA2009_2_nsw <- PISA2009_2 %>% filter(STATE == 1)

# taking all the year 10s out of PISA 2012
PISA2012_nsw <- PISA2012 %>% filter(STRATUM %in% c('AUS0204', 'AUS0205', 'AUS0206')) #For NSW schools

PISA_2015_nsw <- PISA2015 %>% filter(State == 1)

# taking all the year 10s out of PISA 2018
PISA2018_nsw <- PISA2018 %>% filter(State == 1)

# taking all the year 10s out of PISA 2022
PISA2022_nsw <- PISA2022 %>% filter(State == 1)

# cleaning names

PISA2018_nsw <- janitor::clean_names(PISA2018_nsw)
PISA_2015_nsw <- janitor::clean_names(PISA_2015_nsw)
PISA2022_nsw <- janitor::clean_names(PISA2022_nsw)


```

```{r}
# Average Maths Scores for Y10s Across the Years
#2000
nsw_mathmeans_2000 <- Rrepest(data = PISA2000_nsw, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
nsw_mathmeans_2003 <- Rrepest(data = PISA2003_nsw, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
nsw_mathmeans_2006 <- Rrepest(data = PISA2006_nsw, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
nsw_mathmeans_2009 <- Rrepest(data = PISA2009_2_nsw, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@math"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
nsw_mathmeans_2012 <- Rrepest(data = PISA2012_nsw, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
nsw_mathmeans_2015 <- Rrepest(data = PISA_2015_nsw, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
nsw_mathmeans_2018 <- Rrepest(data = PISA2018_nsw, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
nsw_mathmeans_2022 <- Rrepest(data = PISA2022_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

# making dataframe for year 10 math
# Add Year column
nsw_mathmeans_2000$Year <- 2000
nsw_mathmeans_2003$Year <- 2003
nsw_mathmeans_2006$Year <- 2006
nsw_mathmeans_2009$Year <- 2009
nsw_mathmeans_2012$Year <- 2012
nsw_mathmeans_2015$Year <- 2015
nsw_mathmeans_2018$Year <- 2018
nsw_mathmeans_2022$Year <- 2022

nsw_math_means <- rbind(
  nsw_mathmeans_2000,
  nsw_mathmeans_2003,
  nsw_mathmeans_2006,
  nsw_mathmeans_2009,
  nsw_mathmeans_2012,
  nsw_mathmeans_2015,
  nsw_mathmeans_2018,
  nsw_mathmeans_2022
)


nsw_math_means$CI_Lower <- nsw_math_means$`b.mean.pv@math` - 1.96 * nsw_math_means$`se.mean.pv@math`
nsw_math_means$CI_Upper <- nsw_math_means$`b.mean.pv@math` + 1.96 * nsw_math_means$`se.mean.pv@math`

nsw_PISA_mathmeans <- nsw_math_means[, c("Year", ".", "b.mean.pv@math", "se.mean.pv@math", "b.std.pv@math", "se.std.pv@math", "CI_Lower", "CI_Upper")]

```

# FOR QLD - 3

```{r}

# Making charts just for QLD vs General population - Maths
# DATA Pre-processing:
# taking all the NSW students/schools out of PISA 2000
PISA2000_qld <- PISA2000 %>% filter(State == 3)
PISA2003_qld <- PISA2003 %>% filter(State == 3)
PISA2006_qld <- PISA2006 %>% filter(as.numeric(as_factor(State)) == 3)
PISA2009_2_qld <- PISA2009_2 %>% filter(STATE == 3)
PISA2012_qld <- PISA2012 %>% filter(STRATUM %in% c('AUS0410', 'AUS0411', 'AUS0412')) #For NSW schools
PISA_2015_qld <- PISA2015 %>% filter(State == 3)
PISA2018_qld <- PISA2018 %>% filter(State == 3)
PISA2022_qld <- PISA2022 %>% filter(State == 3)
# cleaning names
PISA2018_qld <- janitor::clean_names(PISA2018_qld)
PISA_2015_qld <- janitor::clean_names(PISA_2015_qld)
PISA2022_qld <- janitor::clean_names(PISA2022_qld)


#2000
qld_mathmeans_2000 <- Rrepest(data = PISA2000_qld, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
qld_mathmeans_2003 <- Rrepest(data = PISA2003_qld, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
qld_mathmeans_2006 <- Rrepest(data = PISA2006_qld, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
qld_mathmeans_2009 <- Rrepest(data = PISA2009_2_qld, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@math"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
qld_mathmeans_2012 <- Rrepest(data = PISA2012_qld, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
qld_mathmeans_2015 <- Rrepest(data = PISA_2015_qld, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
qld_mathmeans_2018 <- Rrepest(data = PISA2018_qld, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
qld_mathmeans_2022 <- Rrepest(data = PISA2022_qld, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

# making dataframe for year 10 math
# Add Year column
qld_mathmeans_2000$Year <- 2000
qld_mathmeans_2003$Year <- 2003
qld_mathmeans_2006$Year <- 2006
qld_mathmeans_2009$Year <- 2009
qld_mathmeans_2012$Year <- 2012
qld_mathmeans_2015$Year <- 2015
qld_mathmeans_2018$Year <- 2018
qld_mathmeans_2022$Year <- 2022

qld_math_means <- rbind(
  qld_mathmeans_2000,
  qld_mathmeans_2003,
  qld_mathmeans_2006,
  qld_mathmeans_2009,
  qld_mathmeans_2012,
  qld_mathmeans_2015,
  qld_mathmeans_2018,
  qld_mathmeans_2022
)


qld_math_means$CI_Lower <- qld_math_means$`b.mean.pv@math` - 1.96 * qld_math_means$`se.mean.pv@math`
qld_math_means$CI_Upper <- qld_math_means$`b.mean.pv@math` + 1.96 * qld_math_means$`se.mean.pv@math`

qld_PISA_mathmeans <- qld_math_means[, c("Year", ".", "b.mean.pv@math", "se.mean.pv@math", "b.std.pv@math", "se.std.pv@math", "CI_Lower", "CI_Upper")]

```

4- SA

```{r}

# Making charts just for QLD vs General population - Maths
# DATA Pre-processing:
# taking all the NSW students/schools out of PISA 2000
PISA2000_sa <- PISA2000 %>% filter(State == 4)
PISA2003_sa <- PISA2003 %>% filter(State == 4)
PISA2006_sa <- PISA2006 %>% filter(as.numeric(as_factor(State)) == 4)
PISA2009_2_sa <- PISA2009_2 %>% filter(STATE == 4)
PISA2012_sa <- PISA2012 %>% filter(STRATUM %in% c('AUS0513', 'AUS0514', 'AUS0515')) #For NSW schools
PISA_2015_sa <- PISA2015 %>% filter(State == 4)
PISA2018_sa <- PISA2018 %>% filter(State == 4)
PISA2022_sa <- PISA2022 %>% filter(State == 4)
# cleaning names
PISA2018_sa <- janitor::clean_names(PISA2018_sa)
PISA_2015_sa <- janitor::clean_names(PISA_2015_sa)
PISA2022_sa <- janitor::clean_names(PISA2022_sa)


#2000
sa_mathmeans_2000 <- Rrepest(data = PISA2000_sa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
sa_mathmeans_2003 <- Rrepest(data = PISA2003_sa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
sa_mathmeans_2006 <- Rrepest(data = PISA2006_sa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
sa_mathmeans_2009 <- Rrepest(data = PISA2009_2_sa, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@math"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
sa_mathmeans_2012 <- Rrepest(data = PISA2012_sa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
sa_mathmeans_2015 <- Rrepest(data = PISA_2015_sa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
sa_mathmeans_2018 <- Rrepest(data = PISA2018_sa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
sa_mathmeans_2022 <- Rrepest(data = PISA2022_sa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

# making dataframe for year 10 math
# Add Year column
sa_mathmeans_2000$Year <- 2000
sa_mathmeans_2003$Year <- 2003
sa_mathmeans_2006$Year <- 2006
sa_mathmeans_2009$Year <- 2009
sa_mathmeans_2012$Year <- 2012
sa_mathmeans_2015$Year <- 2015
sa_mathmeans_2018$Year <- 2018
sa_mathmeans_2022$Year <- 2022

sa_math_means <- rbind(
  sa_mathmeans_2000,
  sa_mathmeans_2003,
  sa_mathmeans_2006,
  sa_mathmeans_2009,
  sa_mathmeans_2012,
  sa_mathmeans_2015,
  sa_mathmeans_2018,
  sa_mathmeans_2022
)


sa_math_means$CI_Lower <- sa_math_means$`b.mean.pv@math` - 1.96 * sa_math_means$`se.mean.pv@math`
sa_math_means$CI_Upper <- sa_math_means$`b.mean.pv@math` + 1.96 * sa_math_means$`se.mean.pv@math`

sa_PISA_mathmeans <- sa_math_means[, c("Year", ".", "b.mean.pv@math", "se.mean.pv@math", "b.std.pv@math", "se.std.pv@math", "CI_Lower", "CI_Upper")]

```

5- WA

```{r}
PISA2000_wa <- PISA2000 %>% filter(State == 5)
PISA2003_wa <- PISA2003 %>% filter(State == 5)
PISA2006_wa <- PISA2006 %>% filter(as.numeric(as_factor(State)) == 5)
PISA2009_2_wa <- PISA2009_2 %>% filter(STATE == 5)
PISA2012_wa <- PISA2012 %>% filter(STRATUM %in% c('AUS0616', 'AUS0617', 'AUS0618')) #For WA schools
PISA_2015_wa <- PISA2015 %>% filter(State == 5)
PISA2018_wa <- PISA2018 %>% filter(State == 5)
PISA2022_wa <- PISA2022 %>% filter(State == 5)
# cleaning names
PISA2018_wa <- janitor::clean_names(PISA2018_wa)
PISA_2015_wa <- janitor::clean_names(PISA_2015_wa)
PISA2022_wa <- janitor::clean_names(PISA2022_wa)


#2000
wa_mathmeans_2000 <- Rrepest(data = PISA2000_wa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
wa_mathmeans_2003 <- Rrepest(data = PISA2003_wa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
wa_mathmeans_2006 <- Rrepest(data = PISA2006_wa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
wa_mathmeans_2009 <- Rrepest(data = PISA2009_2_wa, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@math"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
wa_mathmeans_2012 <- Rrepest(data = PISA2012_wa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
wa_mathmeans_2015 <- Rrepest(data = PISA_2015_wa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
wa_mathmeans_2018 <- Rrepest(data = PISA2018_wa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
wa_mathmeans_2022 <- Rrepest(data = PISA2022_wa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

# making dataframe for year 10 math
# Add Year column
wa_mathmeans_2000$Year <- 2000
wa_mathmeans_2003$Year <- 2003
wa_mathmeans_2006$Year <- 2006
wa_mathmeans_2009$Year <- 2009
wa_mathmeans_2012$Year <- 2012
wa_mathmeans_2015$Year <- 2015
wa_mathmeans_2018$Year <- 2018
wa_mathmeans_2022$Year <- 2022

wa_math_means <- rbind(
  wa_mathmeans_2000,
  wa_mathmeans_2003,
  wa_mathmeans_2006,
  wa_mathmeans_2009,
  wa_mathmeans_2012,
  wa_mathmeans_2015,
  wa_mathmeans_2018,
  wa_mathmeans_2022
)


wa_math_means$CI_Lower <- wa_math_means$`b.mean.pv@math` - 1.96 * wa_math_means$`se.mean.pv@math`
wa_math_means$CI_Upper <- wa_math_means$`b.mean.pv@math` + 1.96 * wa_math_means$`se.mean.pv@math`

wa_PISA_mathmeans <- wa_math_means[, c("Year", ".", "b.mean.pv@math", "se.mean.pv@math", "b.std.pv@math", "se.std.pv@math", "CI_Lower", "CI_Upper")]
```

6 - TAS

```{r}
PISA2000_tas <- PISA2000 %>% filter(State == 6)
PISA2003_tas <- PISA2003 %>% filter(State == 6)
PISA2006_tas <- PISA2006 %>% filter(as.numeric(as_factor(State)) == 6)
PISA2009_2_tas <- PISA2009_2 %>% filter(STATE == 6)
PISA2012_tas <- PISA2012 %>% filter(STRATUM %in% c('AUS0719', 'AUS0720', 'AUS0721')) #For TAS schools
PISA_2015_tas <- PISA2015 %>% filter(State == 6)
PISA2018_tas <- PISA2018 %>% filter(State == 6)
PISA2022_tas <- PISA2022 %>% filter(State == 6)
# cleaning names
PISA2018_tas <- janitor::clean_names(PISA2018_tas)
PISA_2015_tas <- janitor::clean_names(PISA_2015_tas)
PISA2022_tas <- janitor::clean_names(PISA2022_tas)


#2000
tas_mathmeans_2000 <- Rrepest(data = PISA2000_tas, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
tas_mathmeans_2003 <- Rrepest(data = PISA2003_tas, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
tas_mathmeans_2006 <- Rrepest(data = PISA2006_tas, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
tas_mathmeans_2009 <- Rrepest(data = PISA2009_2_tas, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@math"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
tas_mathmeans_2012 <- Rrepest(data = PISA2012_tas, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
tas_mathmeans_2015 <- Rrepest(data = PISA_2015_tas, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
tas_mathmeans_2018 <- Rrepest(data = PISA2018_tas, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
tas_mathmeans_2022 <- Rrepest(data = PISA2022_tas, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

# making dataframe for year 10 math
# Add Year column
tas_mathmeans_2000$Year <- 2000
tas_mathmeans_2003$Year <- 2003
tas_mathmeans_2006$Year <- 2006
tas_mathmeans_2009$Year <- 2009
tas_mathmeans_2012$Year <- 2012
tas_mathmeans_2015$Year <- 2015
tas_mathmeans_2018$Year <- 2018
tas_mathmeans_2022$Year <- 2022

tas_math_means <- rbind(
  tas_mathmeans_2000,
  tas_mathmeans_2003,
  tas_mathmeans_2006,
  tas_mathmeans_2009,
  tas_mathmeans_2012,
  tas_mathmeans_2015,
  tas_mathmeans_2018,
  tas_mathmeans_2022
)


tas_math_means$CI_Lower <- tas_math_means$`b.mean.pv@math` - 1.96 * tas_math_means$`se.mean.pv@math`
tas_math_means$CI_Upper <- tas_math_means$`b.mean.pv@math` + 1.96 * tas_math_means$`se.mean.pv@math`

tas_PISA_mathmeans <- tas_math_means[, c("Year", ".", "b.mean.pv@math", "se.mean.pv@math", "b.std.pv@math", "se.std.pv@math", "CI_Lower", "CI_Upper")]
```

7 - NT

```{r}
PISA2000_nt <- PISA2000 %>% filter(State == 7)
PISA2003_nt <- PISA2003 %>% filter(State == 7)
PISA2006_nt <- PISA2006 %>% filter(as.numeric(as_factor(State)) == 7)
PISA2009_2_nt <- PISA2009_2 %>% filter(STATE == 7)
PISA2012_nt <- PISA2012 %>% filter(STRATUM %in% c('AUS0822', 'AUS0823', 'AUS0824')) #For TAS schools
PISA_2015_nt <- PISA2015 %>% filter(State == 7)
PISA2018_nt <- PISA2018 %>% filter(State == 7)
PISA2022_nt <- PISA2022 %>% filter(State == 7)
# cleaning names
PISA2018_nt <- janitor::clean_names(PISA2018_nt)
PISA_2015_nt <- janitor::clean_names(PISA_2015_nt)
PISA2022_nt <- janitor::clean_names(PISA2022_nt)


#2000
nt_mathmeans_2000 <- Rrepest(data = PISA2000_nt, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
nt_mathmeans_2003 <- Rrepest(data = PISA2003_nt, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
nt_mathmeans_2006 <- Rrepest(data = PISA2006_nt, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
nt_mathmeans_2009 <- Rrepest(data = PISA2009_2_nt, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@math"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
nt_mathmeans_2012 <- Rrepest(data = PISA2012_nt, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
nt_mathmeans_2015 <- Rrepest(data = PISA_2015_nt, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
nt_mathmeans_2018 <- Rrepest(data = PISA2018_nt, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
nt_mathmeans_2022 <- Rrepest(data = PISA2022_nt, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

# making dataframe for year 10 math
# Add Year column
nt_mathmeans_2000$Year <- 2000
nt_mathmeans_2003$Year <- 2003
nt_mathmeans_2006$Year <- 2006
nt_mathmeans_2009$Year <- 2009
nt_mathmeans_2012$Year <- 2012
nt_mathmeans_2015$Year <- 2015
nt_mathmeans_2018$Year <- 2018
nt_mathmeans_2022$Year <- 2022

nt_math_means <- rbind(
  nt_mathmeans_2000,
  nt_mathmeans_2003,
  nt_mathmeans_2006,
  nt_mathmeans_2009,
  nt_mathmeans_2012,
  nt_mathmeans_2015,
  nt_mathmeans_2018,
  nt_mathmeans_2022
)


nt_math_means$CI_Lower <- nt_math_means$`b.mean.pv@math` - 1.96 * nt_math_means$`se.mean.pv@math`
nt_math_means$CI_Upper <- nt_math_means$`b.mean.pv@math` + 1.96 * nt_math_means$`se.mean.pv@math`

nt_PISA_mathmeans <- nt_math_means[, c("Year", ".", "b.mean.pv@math", "se.mean.pv@math", "b.std.pv@math", "se.std.pv@math", "CI_Lower", "CI_Upper")]
```

8 - ACT

```{r}
# Filtering data for ACT (State = 8)
PISA2000_act <- PISA2000 %>% filter(State == 8)
PISA2003_act <- PISA2003 %>% filter(State == 8)
PISA2006_act <- PISA2006 %>% filter(as.numeric(as_factor(State)) == 8)
PISA2009_2_act <- PISA2009_2 %>% filter(STATE == 8)
PISA2012_act <- PISA2012 %>% filter(STRATUM %in% c('AUS0101', 'AUS0102', 'AUS0103')) #For ACT schools
PISA2015_act <- PISA2015 %>% filter(State == 8)
PISA2018_act <- PISA2018 %>% filter(State == 8)
PISA2022_act <- PISA2022 %>% filter(State == 8)

# Cleaning names
PISA2018_act <- janitor::clean_names(PISA2018_act)
PISA2015_act <- janitor::clean_names(PISA2015_act)
PISA2022_act <- janitor::clean_names(PISA2022_act)

# Calculating average Maths scores for ACT

# 2000
act_mathmeans_2000 <- Rrepest(data = PISA2000_act, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
# 2003
act_mathmeans_2003 <- Rrepest(data = PISA2003_act, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
# 2006
act_mathmeans_2006 <- Rrepest(data = PISA2006_act, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
# 2009
act_mathmeans_2009 <- Rrepest(data = PISA2009_2_act, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@math"),
       cm.weights = c(paste0("w_fstr", 1:80)))

# 2012
act_mathmeans_2012 <- Rrepest(data = PISA2012_act, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fstr", 1:80)))
# 2015
act_mathmeans_2015 <- Rrepest(data = PISA2015_act, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
# 2018
act_mathmeans_2018 <- Rrepest(data = PISA2018_act, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
# 2022
act_mathmeans_2022 <- Rrepest(data = PISA2022_act, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@math"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

# Making dataframe for Year 10 math scores
# Add Year column
act_mathmeans_2000$Year <- 2000
act_mathmeans_2003$Year <- 2003
act_mathmeans_2006$Year <- 2006
act_mathmeans_2009$Year <- 2009
act_mathmeans_2012$Year <- 2012
act_mathmeans_2015$Year <- 2015
act_mathmeans_2018$Year <- 2018
act_mathmeans_2022$Year <- 2022

# Combine the data
act_math_means <- rbind(
  act_mathmeans_2000,
  act_mathmeans_2003,
  act_mathmeans_2006,
  act_mathmeans_2009,
  act_mathmeans_2012,
  act_mathmeans_2015,
  act_mathmeans_2018,
  act_mathmeans_2022
)

# Calculate Confidence Intervals
act_math_means$CI_Lower <- act_math_means$`b.mean.pv@math` - 1.96 * act_math_means$`se.mean.pv@math`
act_math_means$CI_Upper <- act_math_means$`b.mean.pv@math` + 1.96 * act_math_means$`se.mean.pv@math`

# Select the relevant columns
act_PISA_mathmeans <- act_math_means[, c("Year", ".", "b.mean.pv@math", "se.mean.pv@math", "b.std.pv@math", "se.std.pv@math", "CI_Lower", "CI_Upper")]

```

```{r}
#Creating a chart for the states and mathematics
# Combining all the dataframes
# Adding a 'STATE' column to each dataframe
nsw_PISA_mathmeans <- nsw_PISA_mathmeans %>% mutate(STATE = "NSW")
qld_PISA_mathmeans <- qld_PISA_mathmeans %>% mutate(STATE = "QLD")
sa_PISA_mathmeans <- sa_PISA_mathmeans %>% mutate(STATE = "SA")
wa_PISA_mathmeans <- wa_PISA_mathmeans %>% mutate(STATE = "WA")
tas_PISA_mathmeans <- tas_PISA_mathmeans %>% mutate(STATE = "TAS")
nt_PISA_mathmeans <- nt_PISA_mathmeans %>% mutate(STATE = "NT")
act_PISA_mathmeans <- act_PISA_mathmeans %>% mutate(STATE = "ACT")

# Combining all dataframes into one
all_states_math <- rbind(
  nsw_PISA_mathmeans,
  qld_PISA_mathmeans,
  sa_PISA_mathmeans,
  wa_PISA_mathmeans,
  tas_PISA_mathmeans,
  nt_PISA_mathmeans,
  act_PISA_mathmeans
)


all_states_math$Year <- as.numeric(as.character(all_states_math$Year))

ggplot(all_states_math, aes(x = Year, y = `b.mean.pv@math`, color = STATE)) +
  geom_line() +
  geom_point() +
  geom_errorbar(aes(ymin = CI_Lower, ymax = CI_Upper), width = 0.2) +
  scale_x_continuous(breaks = unique(all_states_math$Year), expand = expansion(mult = c(0.05, 0.05))) +
  facet_wrap(~STATE, scales = "fixed") +  
  labs(title = "Mathematics Scores by State",
       x = "Year",
       y = "Mathematics Score") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 25, hjust = 1, size=7))

```

# STATES LITERACY SCORES

VICTORIA

```{r}
#2000
vic_read_means_2000 <- Rrepest(data = PISA2000_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
vic_read_means_2003 <- Rrepest(data = PISA2003_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
vic_read_means_2006 <- Rrepest(data = PISA2006_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
vic_read_means_2009 <- Rrepest(data = PISA2009_2_vic, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@read"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
vic_read_means_2012 <- Rrepest(data = PISA2012_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
vic_read_means_2015 <- Rrepest(data = PISA_2015_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
vic_read_means_2018 <- Rrepest(data = PISA2018_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
vic_read_means_2022 <- Rrepest(data = PISA2022_vic, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

#combing the dataframes for gen pop avg and conf int
#adding year column
vic_read_means_2000$Year <- 2000
vic_read_means_2003$Year <- 2003
vic_read_means_2006$Year <- 2006
vic_read_means_2009$Year <- 2009
vic_read_means_2012$Year <- 2012
vic_read_means_2015$Year <- 2015
vic_read_means_2018$Year <- 2018
vic_read_means_2022$Year <- 2022

vic_read_all_means <- rbind(
  vic_read_means_2000,
  vic_read_means_2003,
  vic_read_means_2006,
  vic_read_means_2009,
  vic_read_means_2012,
  vic_read_means_2015,
  vic_read_means_2018,
  vic_read_means_2022
)

vic_read_all_means$CI_Lower <- vic_read_all_means$`b.mean.pv@read` - 1.96 * vic_read_all_means$`se.mean.pv@read`
vic_read_all_means$CI_Upper <- vic_read_all_means$`b.mean.pv@read` + 1.96 * vic_read_all_means$`se.mean.pv@read`

vic_PISA_read_means <- vic_read_all_means[, c("Year", ".", "b.mean.pv@read", "se.mean.pv@read", "b.std.pv@read", "se.std.pv@read", "CI_Lower", "CI_Upper")]

```

NSW

```{r}
#2000
nsw_read_means_2000 <- Rrepest(data = PISA2000_nsw, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
nsw_read_means_2003 <- Rrepest(data = PISA2003_nsw, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
nsw_read_means_2006 <- Rrepest(data = PISA2006_nsw, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
nsw_read_means_2009 <- Rrepest(data = PISA2009_2_nsw, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@read"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
nsw_read_means_2012 <- Rrepest(data = PISA2012_nsw, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
nsw_read_means_2015 <- Rrepest(data = PISA_2015_nsw, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
nsw_read_means_2018 <- Rrepest(data = PISA2018_nsw, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
nsw_read_means_2022 <- Rrepest(data = PISA2022_nsw, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

#combing the dataframes for gen pop avg and conf int
#adding year column
nsw_read_means_2000$Year <- 2000
nsw_read_means_2003$Year <- 2003
nsw_read_means_2006$Year <- 2006
nsw_read_means_2009$Year <- 2009
nsw_read_means_2012$Year <- 2012
nsw_read_means_2015$Year <- 2015
nsw_read_means_2018$Year <- 2018
nsw_read_means_2022$Year <- 2022

nsw_read_all_means <- rbind(
  nsw_read_means_2000,
  nsw_read_means_2003,
  nsw_read_means_2006,
  nsw_read_means_2009,
  nsw_read_means_2012,
  nsw_read_means_2015,
  nsw_read_means_2018,
  nsw_read_means_2022
)

nsw_read_all_means$CI_Lower <- nsw_read_all_means$`b.mean.pv@read` - 1.96 * nsw_read_all_means$`se.mean.pv@read`
nsw_read_all_means$CI_Upper <- nsw_read_all_means$`b.mean.pv@read` + 1.96 * nsw_read_all_means$`se.mean.pv@read`

nsw_PISA_read_means <- nsw_read_all_means[, c("Year", ".", "b.mean.pv@read", "se.mean.pv@read", "b.std.pv@read", "se.std.pv@read", "CI_Lower", "CI_Upper")]

```

for ACT

```{r}
#2000
act_read_means_2000 <- Rrepest(data = PISA2000_act, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
act_read_means_2003 <- Rrepest(data = PISA2003_act, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
act_read_means_2006 <- Rrepest(data = PISA2006_act, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
act_read_means_2009 <- Rrepest(data = PISA2009_2_act, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@read"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
act_read_means_2012 <- Rrepest(data = PISA2012_act, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
act_read_means_2015 <- Rrepest(data = PISA2015_act, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
act_read_means_2018 <- Rrepest(data = PISA2018_act, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
act_read_means_2022 <- Rrepest(data = PISA2022_act, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

#combing the dataframes for gen pop avg and conf int
#adding year column
act_read_means_2000$Year <- 2000
act_read_means_2003$Year <- 2003
act_read_means_2006$Year <- 2006
act_read_means_2009$Year <- 2009
act_read_means_2012$Year <- 2012
act_read_means_2015$Year <- 2015
act_read_means_2018$Year <- 2018
act_read_means_2022$Year <- 2022

act_read_all_means <- rbind(
  act_read_means_2000,
  act_read_means_2003,
  act_read_means_2006,
  act_read_means_2009,
  act_read_means_2012,
  act_read_means_2015,
  act_read_means_2018,
  act_read_means_2022
)

act_read_all_means$CI_Lower <- act_read_all_means$`b.mean.pv@read` - 1.96 * act_read_all_means$`se.mean.pv@read`
act_read_all_means$CI_Upper <- act_read_all_means$`b.mean.pv@read` + 1.96 * act_read_all_means$`se.mean.pv@read`

act_PISA_read_means <- act_read_all_means[, c("Year", ".", "b.mean.pv@read", "se.mean.pv@read", "b.std.pv@read", "se.std.pv@read", "CI_Lower", "CI_Upper")]

```

for QLD

```{r}
#2000
qld_read_means_2000 <- Rrepest(data = PISA2000_qld, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
qld_read_means_2003 <- Rrepest(data = PISA2003_qld, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
qld_read_means_2006 <- Rrepest(data = PISA2006_qld, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
qld_read_means_2009 <- Rrepest(data = PISA2009_2_qld, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@read"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
qld_read_means_2012 <- Rrepest(data = PISA2012_qld, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
qld_read_means_2015 <- Rrepest(data = PISA_2015_qld, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
qld_read_means_2018 <- Rrepest(data = PISA2018_qld, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
qld_read_means_2022 <- Rrepest(data = PISA2022_qld, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

#combing the dataframes for gen pop avg and conf int
#adding year column
qld_read_means_2000$Year <- 2000
qld_read_means_2003$Year <- 2003
qld_read_means_2006$Year <- 2006
qld_read_means_2009$Year <- 2009
qld_read_means_2012$Year <- 2012
qld_read_means_2015$Year <- 2015
qld_read_means_2018$Year <- 2018
qld_read_means_2022$Year <- 2022

qld_read_all_means <- rbind(
  qld_read_means_2000,
  qld_read_means_2003,
  qld_read_means_2006,
  qld_read_means_2009,
  qld_read_means_2012,
  qld_read_means_2015,
  qld_read_means_2018,
  qld_read_means_2022
)

qld_read_all_means$CI_Lower <- qld_read_all_means$`b.mean.pv@read` - 1.96 * qld_read_all_means$`se.mean.pv@read`
qld_read_all_means$CI_Upper <- qld_read_all_means$`b.mean.pv@read` + 1.96 * qld_read_all_means$`se.mean.pv@read`

qld_PISA_read_means <- qld_read_all_means[, c("Year", ".", "b.mean.pv@read", "se.mean.pv@read", "b.std.pv@read", "se.std.pv@read", "CI_Lower", "CI_Upper")]

```

```{r}
#2000
nt_read_means_2000 <- Rrepest(data = PISA2000_nt, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
nt_read_means_2003 <- Rrepest(data = PISA2003_nt, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
nt_read_means_2006 <- Rrepest(data = PISA2006_nt, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
nt_read_means_2009 <- Rrepest(data = PISA2009_2_nt, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@read"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
nt_read_means_2012 <- Rrepest(data = PISA2012_nt, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
nt_read_means_2015 <- Rrepest(data = PISA_2015_nt, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
nt_read_means_2018 <- Rrepest(data = PISA2018_nt, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
nt_read_means_2022 <- Rrepest(data = PISA2022_nt, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

#combing the dataframes for gen pop avg and conf int
#adding year column
nt_read_means_2000$Year <- 2000
nt_read_means_2003$Year <- 2003
nt_read_means_2006$Year <- 2006
nt_read_means_2009$Year <- 2009
nt_read_means_2012$Year <- 2012
nt_read_means_2015$Year <- 2015
nt_read_means_2018$Year <- 2018
nt_read_means_2022$Year <- 2022

nt_read_all_means <- rbind(
  nt_read_means_2000,
  nt_read_means_2003,
  nt_read_means_2006,
  nt_read_means_2009,
  nt_read_means_2012,
  nt_read_means_2015,
  nt_read_means_2018,
  nt_read_means_2022
)

nt_read_all_means$CI_Lower <- nt_read_all_means$`b.mean.pv@read` - 1.96 * nt_read_all_means$`se.mean.pv@read`
nt_read_all_means$CI_Upper <- nt_read_all_means$`b.mean.pv@read` + 1.96 * nt_read_all_means$`se.mean.pv@read`

nt_PISA_read_means <- nt_read_all_means[, c("Year", ".", "b.mean.pv@read", "se.mean.pv@read", "b.std.pv@read", "se.std.pv@read", "CI_Lower", "CI_Upper")]

```

```{r}
#2000
sa_read_means_2000 <- Rrepest(data = PISA2000_sa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
sa_read_means_2003 <- Rrepest(data = PISA2003_sa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
sa_read_means_2006 <- Rrepest(data = PISA2006_sa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
sa_read_means_2009 <- Rrepest(data = PISA2009_2_sa, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@read"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
sa_read_means_2012 <- Rrepest(data = PISA2012_sa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
sa_read_means_2015 <- Rrepest(data = PISA_2015_sa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
sa_read_means_2018 <- Rrepest(data = PISA2018_sa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
sa_read_means_2022 <- Rrepest(data = PISA2022_sa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

#combing the dataframes for gen pop avg and conf int
#adding year column
sa_read_means_2000$Year <- 2000
sa_read_means_2003$Year <- 2003
sa_read_means_2006$Year <- 2006
sa_read_means_2009$Year <- 2009
sa_read_means_2012$Year <- 2012
sa_read_means_2015$Year <- 2015
sa_read_means_2018$Year <- 2018
sa_read_means_2022$Year <- 2022

sa_read_all_means <- rbind(
  sa_read_means_2000,
  sa_read_means_2003,
  sa_read_means_2006,
  sa_read_means_2009,
  sa_read_means_2012,
  sa_read_means_2015,
  sa_read_means_2018,
  sa_read_means_2022
)

sa_read_all_means$CI_Lower <- sa_read_all_means$`b.mean.pv@read` - 1.96 * sa_read_all_means$`se.mean.pv@read`
sa_read_all_means$CI_Upper <- sa_read_all_means$`b.mean.pv@read` + 1.96 * sa_read_all_means$`se.mean.pv@read`

sa_PISA_read_means <- sa_read_all_means[, c("Year", ".", "b.mean.pv@read", "se.mean.pv@read", "b.std.pv@read", "se.std.pv@read", "CI_Lower", "CI_Upper")]

```

```{r}
#2000
wa_read_means_2000 <- Rrepest(data = PISA2000_wa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
wa_read_means_2003 <- Rrepest(data = PISA2003_wa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
wa_read_means_2006 <- Rrepest(data = PISA2006_wa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
wa_read_means_2009 <- Rrepest(data = PISA2009_2_wa, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@read"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
wa_read_means_2012 <- Rrepest(data = PISA2012_wa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
wa_read_means_2015 <- Rrepest(data = PISA_2015_wa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
wa_read_means_2018 <- Rrepest(data = PISA2018_wa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
wa_read_means_2022 <- Rrepest(data = PISA2022_wa, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

#combing the dataframes for gen pop avg and conf int
#adding year column
wa_read_means_2000$Year <- 2000
wa_read_means_2003$Year <- 2003
wa_read_means_2006$Year <- 2006
wa_read_means_2009$Year <- 2009
wa_read_means_2012$Year <- 2012
wa_read_means_2015$Year <- 2015
wa_read_means_2018$Year <- 2018
wa_read_means_2022$Year <- 2022

wa_read_all_means <- rbind(
  wa_read_means_2000,
  wa_read_means_2003,
  wa_read_means_2006,
  wa_read_means_2009,
  wa_read_means_2012,
  wa_read_means_2015,
  wa_read_means_2018,
  wa_read_means_2022
)

wa_read_all_means$CI_Lower <- wa_read_all_means$`b.mean.pv@read` - 1.96 * wa_read_all_means$`se.mean.pv@read`
wa_read_all_means$CI_Upper <- wa_read_all_means$`b.mean.pv@read` + 1.96 * wa_read_all_means$`se.mean.pv@read`

wa_PISA_read_means <- wa_read_all_means[, c("Year", ".", "b.mean.pv@read", "se.mean.pv@read", "b.std.pv@read", "se.std.pv@read", "CI_Lower", "CI_Upper")]

```

```{r}
#2000
tas_read_means_2000 <- Rrepest(data = PISA2000_tas, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2003
tas_read_means_2003 <- Rrepest(data = PISA2003_tas, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2006
tas_read_means_2006 <- Rrepest(data = PISA2006_tas, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2009
tas_read_means_2009 <- Rrepest(data = PISA2009_2_tas, 
       svy = "PISA",
       est = est(c("mean", "std"), "pv@read"),
       cm.weights = c(paste0("w_fstr", 1:80)))

#2012
tas_read_means_2012 <- Rrepest(data = PISA2012_tas, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fstr", 1:80)))
#2015
tas_read_means_2015 <- Rrepest(data = PISA_2015_tas, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt",1:80)))
#2018
tas_read_means_2018 <- Rrepest(data = PISA2018_tas, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))
#2022
tas_read_means_2022 <- Rrepest(data = PISA2022_tas, 
        svy = "PISA",
        est = est(c("mean", "std"), "pv@read"),
        cm.weights = c(paste0("w_fsturwt", 1:80)))

#combing the dataframes for gen pop avg and conf int
#adding year column
tas_read_means_2000$Year <- 2000
tas_read_means_2003$Year <- 2003
tas_read_means_2006$Year <- 2006
tas_read_means_2009$Year <- 2009
tas_read_means_2012$Year <- 2012
tas_read_means_2015$Year <- 2015
tas_read_means_2018$Year <- 2018
tas_read_means_2022$Year <- 2022

tas_read_all_means <- rbind(
  tas_read_means_2000,
  tas_read_means_2003,
  tas_read_means_2006,
  tas_read_means_2009,
  tas_read_means_2012,
  tas_read_means_2015,
  tas_read_means_2018,
  tas_read_means_2022
)

tas_read_all_means$CI_Lower <- tas_read_all_means$`b.mean.pv@read` - 1.96 * tas_read_all_means$`se.mean.pv@read`
tas_read_all_means$CI_Upper <- tas_read_all_means$`b.mean.pv@read` + 1.96 * tas_read_all_means$`se.mean.pv@read`

tas_PISA_read_means <- tas_read_all_means[, c("Year", ".", "b.mean.pv@read", "se.mean.pv@read", "b.std.pv@read", "se.std.pv@read", "CI_Lower", "CI_Upper")]

```

```{r}
nsw_PISA_read_means <- nsw_PISA_read_means %>% mutate(STATE = "NSW")
qld_PISA_read_means <- qld_PISA_read_means %>% mutate(STATE = "QLD")
sa_PISA_read_means <- sa_PISA_read_means %>% mutate(STATE = "SA")
wa_PISA_read_means <- wa_PISA_read_means %>% mutate(STATE = "WA")
tas_PISA_read_means <- tas_PISA_read_means %>% mutate(STATE = "TAS")
nt_PISA_read_means <- nt_PISA_read_means %>% mutate(STATE = "NT")
act_PISA_read_means <- act_PISA_read_means %>% mutate(STATE = "ACT")
#adding victoria

# Combining all dataframes into one
all_states_read <- rbind(
  nsw_PISA_read_means,
  qld_PISA_read_means,
  sa_PISA_read_means,
  wa_PISA_read_means,
  tas_PISA_read_means,
  nt_PISA_read_means,
  act_PISA_read_means
)

all_states_read$Year <- as.numeric(as.character(all_states_read$Year))

ggplot(all_states_read, aes(x = Year, y = `b.mean.pv@read`, color = STATE)) +
  geom_line() +
  geom_point() +
  geom_errorbar(aes(ymin = CI_Lower, ymax = CI_Upper), width = 0.2) +
  scale_x_continuous(breaks = unique(all_states_read$Year), expand = expansion(mult = c(0.05, 0.05))) +
  facet_wrap(~STATE, scales = "fixed") +  
  labs(title = "Year 10 Reading Scores by State",
       x = "Year",
       y = "Reading Score") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 25, hjust = 1, size = 7))

```
